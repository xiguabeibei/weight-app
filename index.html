<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="ä½“é‡æœ¬">
<title>ä½“é‡æœ¬</title>

<style>
:root{
  --pink:#ff8fb1;
  --purple:#b69cff;
  --bg:#f6f7fb;
  --card:#fff;
  --text:#222;
  --sub:#777;
}

@media (prefers-color-scheme: dark){
  :root{
    --bg:#0f1115;
    --card:#1c1f26;
    --text:#f2f2f2;
    --sub:#aaa;
  }
}

body{
  margin:0;
  background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC";
  color:var(--text);
}

.app{padding:20px;padding-bottom:140px;}

h1{font-size:26px;margin:4px 0 14px;}
h2{font-size:18px;color:var(--sub);margin-bottom:8px;}

.card{
  background:var(--card);
  border-radius:26px;
  padding:20px;
  margin-bottom:18px;
  box-shadow:0 14px 40px rgba(0,0,0,.12);
  animation:up .45s cubic-bezier(.2,.8,.2,1);
}

@keyframes up{
  from{opacity:0;transform:translateY(24px) scale(.96)}
  to{opacity:1;transform:none}
}

input{
  width:100%;
  padding:18px;
  border-radius:20px;
  border:1px solid #eee;
  font-size:18px;
  margin-bottom:12px;
}

button{
  width:100%;
  padding:18px;
  border-radius:999px;
  background:linear-gradient(135deg,var(--pink),var(--purple));
  color:#fff;
  border:none;
  font-size:18px;
}

.big{
  font-size:52px;
  font-weight:800;
  color:var(--pink);
}

.big.pop{animation:pop .4s cubic-bezier(.3,1.4,.4,1)}
@keyframes pop{from{transform:scale(.8)}to{transform:scale(1)}}

.tabs{
  position:fixed;bottom:0;left:0;right:0;
  display:flex;
  background:var(--card);
  border-top:1px solid #ddd;
}

.tabs button{
  flex:1;
  background:none;
  border:none;
  padding:16px 0 12px;
  font-size:15px;
}

.page{display:none;animation:slide .35s ease}
.page.active{display:block}

@keyframes slide{
  from{opacity:0;transform:translateX(20px)}
  to{opacity:1;transform:none}
}

.streak{
  font-size:20px;
  color:var(--pink);
  margin-top:6px;
}

.chart{
  height:140px;
  display:flex;
  align-items:flex-end;
  gap:6px;
}

.bar{
  flex:1;
  background:var(--purple);
  border-radius:8px 8px 0 0;
  animation:grow .6s ease forwards;
}

@keyframes grow{
  from{height:0}
  to{height:var(--h)}
}

.modal{
  position:fixed;
  inset:0;
  background:#0008;
  display:none;
  align-items:center;
  justify-content:center;
}

.modal.show{display:flex}

.modal .card{text-align:center}

.mood span{
  font-size:30px;
  margin-right:10px;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="app">

<div class="page active" id="home">
<h1 id="quote">ä»Šå¤©ä¹Ÿè¦æ¸©æŸ” ğŸŒ·</h1>

<div class="card">
<input id="weight" type="number" step="0.1" placeholder="ä»Šå¤©çš„ä½“é‡ kg">
<div class="mood">
<span onclick="setMood('ğŸ™‚')">ğŸ™‚</span>
<span onclick="setMood('ğŸ˜')">ğŸ˜</span>
<span onclick="setMood('ğŸ˜£')">ğŸ˜£</span>
</div>
<button onclick="save()">ä¿å­˜</button>
<div class="big" id="today">-- kg</div>
<div class="streak" id="streak"></div>
</div>

<div class="card">
<h2>7 æ—¥è¶‹åŠ¿</h2>
<div class="chart" id="chart"></div>
</div>
</div>

<div class="page" id="list">
<h1>è®°å½• ğŸ“–</h1>
<div class="card" id="records"></div>
</div>

</div>

<div class="tabs">
<button onclick="show('home')">ğŸ <br>ä»Šå¤©</button>
<button onclick="show('list')">ğŸ“–<br>è®°å½•</button>
</div>

<div class="modal" id="celebrate">
<div class="card">
<h1>ğŸ‰ å¤ªæ£’äº†ï¼</h1>
<p id="celebrateText"></p>
<button onclick="closeCelebrate()">ç»§ç»­è®°å½•</button>
</div>
</div>

<script>
const quotes=[
"æ…¢æ…¢æ¥ï¼Œä½ å·²ç»å¾ˆæ£’äº† ğŸ’—",
"æ¯ä¸€å¤©éƒ½ç®—æ•° ğŸŒ±",
"èº«ä½“åœ¨æ‚„æ‚„å˜å¥½ âœ¨",
"è®°å½•å°±æ˜¯çˆ±è‡ªå·± ğŸ§¸"
];

let mood="";
const data=JSON.parse(localStorage.getItem("data")||"{}");
const todayKey=new Date().toISOString().slice(0,10);

function save(){
 const w=weight.value;
 if(!w)return;
 data[todayKey]={w,mood};
 localStorage.setItem("data",JSON.stringify(data));
 today.classList.remove("pop");
 void today.offsetWidth;
 today.classList.add("pop");
 render();
}

function render(){
 quote.innerText=quotes[new Date().getDate()%quotes.length];
 today.innerText=data[todayKey]?data[todayKey].w+" kg":"-- kg";

 let s=0,d=new Date();
 while(true){
  const k=d.toISOString().slice(0,10);
  if(data[k]){s++;d.setDate(d.getDate()-1);}else break;
 }
 streak.innerText=s>1?`ğŸ”¥ è¿ç»­ ${s} å¤©`:"";

 if([7,14,30].includes(s)){
  celebrate.classList.add("show");
  celebrateText.innerText=`ä½ å·²ç»è¿ç»­è®°å½• ${s} å¤©å•¦ ğŸ’–`;
 }

 renderChart();
 renderList();
}

function renderChart(){
 chart.innerHTML="";
 const days=Object.keys(data).sort().slice(-7);
 const max=Math.max(...days.map(d=>data[d].w));
 days.forEach(d=>{
  const bar=document.createElement("div");
  bar.className="bar";
  bar.style.setProperty("--h",(data[d].w/max*100)+"%");
  chart.appendChild(bar);
 });
}

function renderList(){
 records.innerHTML="";
 Object.keys(data).sort().reverse().forEach(d=>{
  records.innerHTML+=`<div>${d} Â· ${data[d].w}kg ${data[d].mood||""}</div>`;
 });
}

function setMood(m){mood=m}
function show(id){
 document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}
function closeCelebrate(){celebrate.classList.remove("show")}

const weight=document.getElementById("weight");
const today=document.getElementById("today");
const streak=document.getElementById("streak");
const chart=document.getElementById("chart");
const records=document.getElementById("records");
const quote=document.getElementById("quote");
const celebrate=document.getElementById("celebrate");
const celebrateText=document.getElementById("celebrateText");

render();
</script>
</body>
</html>
