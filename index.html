<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SmartFit Life Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        body { font-family: 'Nunito', sans-serif; background: #f0f4ff; color: #1e293b; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.4); }
        .sidebar-active { background: #6366f1; color: white; box-shadow: 0 8px 15px rgba(99, 102, 241, 0.2); }
        .tech-gradient { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        .progress-bar-bg { background: #e2e8f0; height: 16px; border-radius: 50px; overflow: hidden; position: relative; }
        .progress-fill { background: linear-gradient(90deg, #6366f1, #a855f7); transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="flex h-screen overflow-hidden p-4">

    <aside class="w-64 glass rounded-[2rem] flex flex-col p-6 shadow-xl mr-4">
        <div class="flex items-center gap-3 mb-8 px-2">
            <div class="w-10 h-10 tech-gradient rounded-xl flex items-center justify-center text-white"><i data-lucide="sparkles"></i></div>
            <h1 class="font-900 text-xl tracking-tight">SmartFit</h1>
        </div>
        <nav id="user-nav" class="flex-1 space-y-3 overflow-y-auto custom-scrollbar"></nav>
        <button onclick="openUserModal()" class="mt-4 p-4 border-2 border-dashed border-slate-300 rounded-2xl text-slate-500 hover:border-indigo-400 hover:text-indigo-500 flex items-center justify-center gap-2 font-bold transition-all">
            <i data-lucide="user-plus"></i> æ–°å¢
        </button>
    </aside>

    <main class="flex-1 flex flex-col gap-4 overflow-y-auto custom-scrollbar pr-2">
        <div class="glass p-8 rounded-[2.5rem] shadow-sm relative overflow-hidden">
            <div class="flex justify-between items-end mb-4">
                <div>
                    <h2 id="display-name" class="text-2xl font-900">--</h2>
                    <p class="text-slate-400 font-bold">å½“å‰: <span id="cur-w-txt">0</span>kg / ç›®æ ‡: <span id="tar-w-txt">0</span>kg</p>
                </div>
                <div id="status-tag" class="text-right font-black text-indigo-600 text-3xl tabular-nums">0.0</div>
            </div>
            
            <div class="progress-bar-bg mb-4">
                <div id="progress-fill" class="progress-fill h-full w-0"></div>
                <div class="absolute right-0 top-0 h-full w-1 bg-orange-400 shadow-sm"></div>
            </div>
            
            <p id="motivate-txt" class="text-center font-bold italic text-slate-500 bg-white/40 py-2 rounded-xl">åŠ è½½ä¸­...</p>
        </div>

        <div class="glass p-6 rounded-[2.5rem] shadow-sm flex-1">
            <div class="flex justify-between items-center mb-4">
                <div class="flex gap-2">
                    <input type="date" id="w-date" class="bg-white/50 px-3 py-2 rounded-xl font-bold border-none outline-none">
                    <select id="w-slot" class="bg-white/50 px-3 py-2 rounded-xl font-bold outline-none border-none">
                        <option value="morning">æ™¨é—´ AM</option>
                        <option value="evening">æ™šé—´ PM</option>
                    </select>
                    <input type="number" id="w-val" step="0.1" placeholder="ä½“é‡" class="w-24 bg-white/50 px-3 py-2 rounded-xl font-bold outline-none">
                    <button onclick="submitWeight()" class="tech-gradient text-white px-4 rounded-xl font-black">è®°å½•</button>
                </div>
                <div class="flex bg-slate-100 p-1 rounded-xl text-xs font-bold" id="ranges">
                    <button onclick="updateRange(7)" id="r7" class="px-3 py-1 rounded-lg">7å¤©</button>
                    <button onclick="updateRange(30)" id="r30" class="px-3 py-1 rounded-lg">30å¤©</button>
                </div>
            </div>
            <div class="h-64"><canvas id="weightChart"></canvas></div>
        </div>
    </main>

    <aside class="w-96 flex flex-col gap-4 ml-4">
        <div class="glass p-6 rounded-[2.5rem] shadow-sm">
            <h3 class="font-black text-slate-700 mb-4">ğŸ“ è¡¥è®°æ—¥å¿—</h3>
            <div class="grid grid-cols-2 gap-2 mb-3">
                <input type="date" id="l-date" class="bg-white/50 p-2 rounded-xl text-xs font-bold outline-none border-none">
                <select id="l-slot" class="bg-white/50 p-2 rounded-xl text-xs font-bold outline-none">
                    <option value="æ—©èµ·">æ—©é¤/æ—©èµ·</option>
                    <option value="ä¸­åˆ">åˆé¤</option>
                    <option value="ä¸‹åˆèŒ¶">ä¸‹åˆèŒ¶</option>
                    <option value="æ™šä¸Š">æ™šé¤</option>
                    <option value="å®µå¤œ">å®µå¤œ</option>
                </select>
            </div>
            <div class="space-y-2">
                <div class="flex gap-2">
                    <button id="tab-food" onclick="activeType='food';render()" class="flex-1 p-2 rounded-xl font-bold text-xs bg-orange-50 text-orange-600 border border-orange-200 transition-all">ğŸ é¥®é£Ÿ</button>
                    <button id="tab-sport" onclick="activeType='sport';render()" class="flex-1 p-2 rounded-xl font-bold text-xs bg-slate-50 text-slate-400 transition-all">âš¡ è¿åŠ¨</button>
                </div>
                <input type="text" id="l-name" placeholder="åç§°" class="w-full bg-white/50 p-3 rounded-xl outline-none font-bold">
                <div class="flex gap-2">
                    <input type="number" id="l-cal" placeholder="å¡è·¯é‡Œ" class="flex-1 bg-white/50 p-3 rounded-xl outline-none font-bold">
                    <button onclick="submitLog()" class="tech-gradient text-white px-6 rounded-xl font-black">æ·»åŠ </button>
                </div>
            </div>
        </div>

        <div class="flex-1 flex gap-3 overflow-hidden">
            <div class="flex-1 glass rounded-[2.5rem] p-4 flex flex-col shadow-sm">
                <h4 class="text-xs font-900 text-orange-500 mb-3 text-center tracking-widest uppercase">Intake</h4>
                <div id="list-food" class="flex-1 overflow-y-auto space-y-2 custom-scrollbar pr-1"></div>
            </div>
            <div class="flex-1 glass rounded-[2.5rem] p-4 flex flex-col shadow-sm">
                <h4 class="text-xs font-900 text-green-500 mb-3 text-center tracking-widest uppercase">Burn</h4>
                <div id="list-sport" class="flex-1 overflow-y-auto space-y-2 custom-scrollbar pr-1"></div>
            </div>
        </div>
    </aside>

    <div id="u-modal" class="hidden fixed inset-0 bg-slate-900/40 backdrop-blur-md z-50 flex items-center justify-center p-6">
        <div class="bg-white rounded-[2.5rem] p-10 w-full max-w-md">
            <h2 class="text-2xl font-900 mb-6 text-slate-800 text-center">æ–°æˆå‘˜åŠ å…¥</h2>
            <div class="space-y-4">
                <input type="text" id="nu-name" placeholder="æ˜µç§°" class="w-full bg-slate-50 p-5 rounded-2xl outline-none font-bold">
                <input type="number" id="nu-target" placeholder="ç›®æ ‡ä½“é‡ (kg)" class="w-full bg-slate-50 p-5 rounded-2xl outline-none font-bold">
                <div class="flex gap-4 pt-4">
                    <button onclick="closeUserModal()" class="flex-1 font-bold text-slate-400">è¿”å›</button>
                    <button onclick="addUser()" class="flex-1 p-5 tech-gradient text-white rounded-2xl font-black">åˆ›å»º</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let users = JSON.parse(localStorage.getItem('sf_v3') || '[]');
        let curUid = localStorage.getItem('sf_v3_uid') || null;
        let activeRange = 30;
        let activeType = 'food';
        let chart = null;

        const quotes = {
            gain: ["å°è‚‰è‚‰æ˜¯æš‚æ—¶çš„ï¼Œä½ æ˜¯æœ€æ£’çš„ï¼", "å¤šå‡ºçš„é‡é‡æ˜¯åŠªåŠ›çš„å‹‹ç« ï¼Œåˆ«æ”¾å¼ƒå“¦~", "åƒå¥½ç¡å¥½ï¼Œæ˜å¤©åˆæ˜¯æ–°çš„ä¸€å¤©ï¼"],
            lose: ["çœ‹ï¼ä½ åœ¨å‘å…‰ï¼è¿™å°±æ˜¯è‡ªå¾‹çš„é­…åŠ›ï¼", "å“‡ï¼ç¦»ç›®æ ‡åˆè¿‘äº†ä¸€æ­¥ï¼Œå¤ªç‰›äº†ï¼", "è½»ç›ˆçš„æ„Ÿè§‰çœŸå¥½ï¼Œç»§ç»­ä¿æŒå–”ï¼"],
            reach: ["å¤©å‘ï¼ä½ åšåˆ°äº†ï¼ä½ æ˜¯è‡ªå·±çš„è‹±é›„ï¼", "ç›®æ ‡è¾¾æˆï¼å»ç»™è‡ªå·±ä¸€ä¸ªå°å¥–åŠ±å§~"]
        };

        // åˆå§‹åŒ–æ—¥æœŸ
        document.getElementById('w-date').valueAsDate = new Date();
        document.getElementById('l-date').valueAsDate = new Date();

        function sync() {
            localStorage.setItem('sf_v3', JSON.stringify(users));
            if(curUid) localStorage.setItem('sf_v3_uid', curUid);
            render();
        }

        function addUser() {
            const name = document.getElementById('nu-name').value, target = parseFloat(document.getElementById('nu-target').value);
            if(!name || !target) return;
            const u = { id: Date.now(), name, target, weights: [], logs: [] };
            users.push(u); curUid = u.id;
            closeUserModal(); sync();
        }

        function submitWeight() {
            const val = parseFloat(document.getElementById('w-val').value), date = document.getElementById('w-date').value, slot = document.getElementById('w-slot').value;
            if(!val || !curUid) return;
            const u = users.find(x => x.id == curUid);
            const exist = u.weights.find(x => x.date === date && x.slot === slot);
            if(exist) exist.val = val; else u.weights.push({ val, slot, date, ts: new Date(date).getTime() + (slot === 'morning' ? 0 : 43200000) });
            u.weights.sort((a,b) => a.ts - b.ts);
            document.getElementById('w-val').value = ''; sync();
        }

        function submitLog() {
            const name = document.getElementById('l-name').value, cal = parseInt(document.getElementById('l-cal').value), date = document.getElementById('l-date').value, slot = document.getElementById('l-slot').value;
            if(!name || !cal || !curUid) return;
            users.find(x => x.id == curUid).logs.unshift({ type: activeType, name, cal, slot, date });
            document.getElementById('l-name').value = ''; document.getElementById('l-cal').value = ''; sync();
        }

        function openUserModal() { document.getElementById('u-modal').classList.remove('hidden'); }
        function closeUserModal() { document.getElementById('u-modal').classList.add('hidden'); }
        function updateRange(r) { activeRange = r; render(); }

        function render() {
            const nav = document.getElementById('user-nav');
            nav.innerHTML = users.map(u => `<button onclick="curUid=${u.id};sync()" class="w-full flex items-center gap-3 p-4 rounded-2xl transition-all ${curUid == u.id ? 'sidebar-active' : 'text-slate-500 hover:bg-white'}"><i data-lucide="user"></i><span class="font-black">${u.name}</span></button>`).join('');
            
            const u = users.find(x => x.id == curUid);
            if(!u) return lucide.createIcons();

            document.getElementById('display-name').innerText = u.name;
            const curW = u.weights[u.weights.length-1]?.val || 0;
            document.getElementById('cur-w-txt').innerText = curW;
            document.getElementById('tar-w-txt').innerText = u.target;
            
            // è¿›åº¦æ¡é€»è¾‘ï¼šä»¥ç›®æ ‡ä½“é‡ä¸ºç»ˆç‚¹ï¼Œåˆå§‹ä½“é‡ï¼ˆæˆ–æ¯”ç›®æ ‡é‡20kgï¼‰ä¸ºèµ·ç‚¹
            const startW = u.weights[0]?.val || curW + 10;
            const total = Math.abs(startW - u.target);
            const progressed = Math.abs(startW - curW);
            const percent = Math.min(100, Math.max(5, (progressed / (total || 1)) * 100));
            document.getElementById('progress-fill').style.width = percent + '%';
            
            const diff = (curW - u.target).toFixed(1);
            const tag = document.getElementById('status-tag');
            tag.innerText = (diff > 0 ? "+" : "") + diff;
            tag.className = diff <= 0 ? "text-right font-black text-green-500 text-3xl tabular-nums" : "text-right font-black text-indigo-600 text-3xl tabular-nums";

            // é¼“åŠ±è¯­
            const mBox = document.getElementById('motivate-txt');
            if(diff > 0) mBox.innerText = quotes.gain[Math.floor(Math.random()*3)];
            else if(diff <= 0 && diff > -2) mBox.innerText = quotes.reach[Math.floor(Math.random()*2)];
            else mBox.innerText = quotes.lose[Math.floor(Math.random()*3)];

            // æ—¥å¿—åˆ—è¡¨å·¦å³åˆ†å¼€
            const foodBox = document.getElementById('list-food'), sportBox = document.getElementById('list-sport');
            const lDate = document.getElementById('l-date').value;
            const dayLogs = u.logs.filter(x => x.date === lDate);
            
            const itemHtml = (l) => `<div class="p-3 glass rounded-xl text-[10px]"><div class="font-black">${l.name}</div><div class="flex justify-between text-slate-400"><span>${l.slot}</span><span class="font-bold text-slate-600">${l.cal}kcal</span></div></div>`;
            foodBox.innerHTML = dayLogs.filter(x => x.type === 'food').map(itemHtml).join('');
            sportBox.innerHTML = dayLogs.filter(x => x.type === 'sport').map(itemHtml).join('');

            // Tab çŠ¶æ€
            document.getElementById('tab-food').className = activeType === 'food' ? "flex-1 p-2 rounded-xl font-bold text-xs bg-orange-50 text-orange-600 border border-orange-200" : "flex-1 p-2 rounded-xl font-bold text-xs bg-slate-50 text-slate-400";
            document.getElementById('tab-sport').className = activeType === 'sport' ? "flex-1 p-2 rounded-xl font-bold text-xs bg-green-50 text-green-600 border border-green-200" : "flex-1 p-2 rounded-xl font-bold text-xs bg-slate-50 text-slate-400";

            renderChart(u.weights);
            lucide.createIcons();
        }

        function renderChart(ws) {
            const ctx = document.getElementById('weightChart').getContext('2d');
            const cutoff = Date.now() - activeRange * 86400000;
            const f = ws.filter(x => x.ts >= cutoff);
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: f.map(x => x.date.slice(5) + (x.slot === 'morning' ? ' AM' : ' PM')),
                    datasets: [{
                        data: f.map(x => x.val),
                        borderColor: '#6366f1', borderWidth: 4, pointRadius: 5, tension: 0.4, fill: true,
                        backgroundColor: (c) => { const g = ctx.createLinearGradient(0,0,0,300); g.addColorStop(0,'rgba(99,102,241,0.2)'); g.addColorStop(1,'transparent'); return g; }
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { padding: 10, titleFont: { size: 14 } } }, scales: { x: { display: false } } }
            });
        }
        window.onload = render;
    </script>
</body>
</html>
