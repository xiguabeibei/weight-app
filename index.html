<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="ä½“é‡æœ¬">

<title>ä½“é‡æœ¬</title>

<style>
:root{
  --pink:#ff8fb1;
  --bg:#f6f7fb;
  --card:#ffffff;
  --text:#222;
  --sub:#777;
}

@media (prefers-color-scheme: dark){
  :root{
    --bg:#0f1115;
    --card:#1c1f26;
    --text:#f2f2f2;
    --sub:#aaa;
  }
}

body{
  margin:0;
  background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Hiragino Sans",sans-serif;
  color:var(--text);
}

.app{
  padding:20px;
  padding-bottom:120px;
}

h1{font-size:26px;margin:4px 0 14px;}
h2{font-size:18px;margin:0 0 8px;color:var(--sub);}

.card{
  background:var(--card);
  border-radius:24px;
  padding:18px;
  margin-bottom:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  animation:fadeUp .3s ease;
}

@keyframes fadeUp{
  from{opacity:.6;transform:translateY(10px)}
  to{opacity:1;transform:none}
}

input,select{
  width:100%;
  padding:16px;
  border-radius:18px;
  border:1px solid #eee;
  font-size:17px;
  margin-bottom:12px;
  box-sizing:border-box;
}

button{
  width:100%;
  padding:16px;
  border-radius:999px;
  background:var(--pink);
  color:#fff;
  border:none;
  font-size:17px;
}

.big{
  font-size:46px;
  font-weight:800;
  color:var(--pink);
}

.user-chip{
  display:inline-block;
  padding:6px 12px;
  border-radius:999px;
  background:#eee;
  font-size:14px;
  margin-right:8px;
  cursor:pointer;
}

.user-chip.active{
  background:var(--pink);
  color:#fff;
}

.tabs{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  display:flex;
  background:var(--card);
  border-top:1px solid #ddd;
}

.tabs button{
  flex:1;
  background:none;
  border:none;
  padding:16px 0 12px;
  font-size:15px;
}

.page{display:none;}
.page.active{display:block;}
</style>
</head>

<body>
<div class="app">

<!-- ç”¨æˆ·é€‰æ‹© -->
<div class="card">
  <h2>å½“å‰ä½¿ç”¨è€…</h2>
  <div id="users"></div>
  <input id="newUser" placeholder="æ·»åŠ å®¶äººåå­—">
  <button onclick="addUser()">æ·»åŠ ç”¨æˆ·</button>
</div>

<!-- ä»Šæ—¥ -->
<div class="page active" id="home">
  <h1 id="hello">ä»Šå¤© ğŸŒ·</h1>
  <div class="card">
    <input id="weight" type="number" step="0.1" placeholder="ä»Šå¤©çš„ä½“é‡ kg">
    <button onclick="save()">ä¿å­˜è®°å½•</button>
    <div class="big" id="today">-- kg</div>
    <div id="streak"></div>
  </div>
</div>

<!-- è®°å½• -->
<div class="page" id="listPage">
  <h1>è®°å½• ğŸ“–</h1>
  <div class="card" id="list"></div>
</div>

</div>

<div class="tabs">
  <button onclick="show('home')">ğŸ <br>ä»Šå¤©</button>
  <button onclick="show('listPage')">ğŸ“–<br>è®°å½•</button>
</div>

<script>
const store=JSON.parse(localStorage.getItem("store")||"{}");
store.users=store.users||{};
let current=localStorage.getItem("currentUser")||null;

const today=()=>new Date().toISOString().slice(0,10);

function saveStore(){
 localStorage.setItem("store",JSON.stringify(store));
 localStorage.setItem("currentUser",current);
}

function addUser(){
 const name=newUser.value.trim();
 if(!name||store.users[name]) return;
 store.users[name]={records:{}};
 current=name;
 newUser.value="";
 saveStore();
 render();
}

function switchUser(name){
 current=name;
 saveStore();
 render();
}

function save(){
 if(!current) return;
 const w=weight.value;
 if(!w) return;
 store.users[current].records[today()]={w};
 weight.value="";
 saveStore();
 render();
}

function calcStreak(records){
 let s=0,d=new Date();
 while(true){
  const k=d.toISOString().slice(0,10);
  if(records[k]){s++;d.setDate(d.getDate()-1);}
  else break;
 }
 return s;
}

function render(){
 users.innerHTML="";
 Object.keys(store.users).forEach(u=>{
  const span=document.createElement("span");
  span.className="user-chip"+(u===current?" active":"");
  span.innerText=u;
  span.onclick=()=>switchUser(u);
  users.appendChild(span);
 });

 if(!current) return;

 hello.innerText=`${current}ï¼Œä»Šå¤©ä¹Ÿè¦æ¸©æŸ” ğŸŒ·`;

 const rec=store.users[current].records;
 todayEl.innerText=rec[today()]?rec[today()].w+" kg":"-- kg";

 const s=calcStreak(rec);
 streak.innerText=s>1?`ğŸ”¥ è¿ç»­è®°å½• ${s} å¤©`:"";

 list.innerHTML="";
 Object.keys(rec).sort().reverse().forEach(d=>{
  const div=document.createElement("div");
  div.innerText=`${d} Â· ${rec[d].w} kg`;
  list.appendChild(div);
 });
}

function show(id){
 document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}

const users=document.getElementById("users");
const newUser=document.getElementById("newUser");
const weight=document.getElementById("weight");
const todayEl=document.getElementById("today");
const streak=document.getElementById("streak");
const list=document.getElementById("list");
const hello=document.getElementById("hello");

render();
</script>
</body>
</html>
