<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ä½“é‡æœ¬">

<title>ä½“é‡æœ¬ ğŸ’—</title>

<style>
:root{
  --pink:#ff8fb1;
  --bg:#fff7fb;
  --card:#ffffff;
  --text:#333;
  --sub:#888;
}

body{
  margin:0;
  background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Hiragino Sans",sans-serif;
  color:var(--text);
}

.app{
  padding:22px;
  padding-bottom:110px;
}

h1{
  font-size:26px;
  margin:6px 0 14px;
}

.section-title{
  font-size:18px;
  margin-bottom:8px;
}

.card{
  background:var(--card);
  border-radius:26px;
  padding:20px;
  margin-bottom:18px;
  box-shadow:0 12px 30px rgba(0,0,0,.08);
}

input,select{
  width:100%;
  padding:16px;
  border-radius:18px;
  border:1px solid #eee;
  font-size:18px;
  box-sizing:border-box;
  margin-bottom:12px;
}

button{
  width:100%;
  padding:16px;
  border-radius:999px;
  background:var(--pink);
  color:#fff;
  border:none;
  font-size:18px;
}

.big{
  font-size:44px;
  font-weight:700;
  color:var(--pink);
  margin-top:10px;
}

.tip{
  font-size:15px;
  color:var(--sub);
  margin-top:6px;
}

.record{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:12px;
}

.record span{
  font-size:16px;
}

.record button{
  width:auto;
  padding:8px 14px;
  font-size:14px;
  background:#f2f2f2;
  color:#666;
}

.tabs{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  display:flex;
  background:#fff;
  border-top:1px solid #eee;
}

.tabs button{
  flex:1;
  background:none;
  border:none;
  padding:14px 0 10px;
  font-size:15px;
}

.page{display:none;}
.page.active{display:block;}
</style>
</head>

<body>
<div class="app">

<!-- ä»Šæ—¥ -->
<div class="page active" id="home">
  <h1>ä»Šå¤©ä¹Ÿå¾ˆæ£’ ğŸŒ·</h1>
  <div class="card">
    <select id="who">
      <option value="me">æˆ‘</option>
      <option value="ta">TA</option>
    </select>

    <input id="weight" type="number" step="0.1" placeholder="ä»Šå¤©çš„ä½“é‡ kg">
    <input id="note" placeholder="å¤‡æ³¨ï¼ˆåƒå¤šäº† / è¿åŠ¨äº†ï¼‰">
    <button onclick="save()">ä¿å­˜ä»Šå¤©</button>

    <div class="big" id="today">-- kg</div>
    <div class="tip" id="date"></div>
  </div>
</div>

<!-- è®°å½• -->
<div class="page" id="listPage">
  <h1>è®°å½• ğŸ“–</h1>
  <div class="card" id="list"></div>
</div>

<!-- è¶‹åŠ¿ -->
<div class="page" id="chartPage">
  <h1>è¶‹åŠ¿ ğŸ“ˆ</h1>
  <div class="card">
    <canvas id="chart"></canvas>
  </div>
</div>

<!-- è®¾ç½® -->
<div class="page" id="setting">
  <h1>è®¾ç½® âš™ï¸</h1>
  <div class="card">
    <input id="meName" placeholder="æˆ‘çš„æ˜µç§°">
    <input id="taName" placeholder="TA çš„æ˜µç§°">
    <input id="target" placeholder="ç›®æ ‡ä½“é‡ kg">
    <button onclick="saveSetting()">ä¿å­˜è®¾ç½®</button>
  </div>
</div>

</div>

<!-- Tab -->
<div class="tabs">
  <button onclick="show('home')">ğŸ <br>ä»Šå¤©</button>
  <button onclick="show('listPage')">ğŸ“–<br>è®°å½•</button>
  <button onclick="show('chartPage')">ğŸ“ˆ<br>è¶‹åŠ¿</button>
  <button onclick="show('setting')">âš™ï¸<br>è®¾ç½®</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const today=new Date().toISOString().slice(0,10);
const data=JSON.parse(localStorage.getItem("data")||"{}");
const setting=JSON.parse(localStorage.getItem("setting")||"{}");

function show(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if(id==="chartPage") drawChart();
}

function save(){
  const who=whoEl().value;
  const w=weightEl().value;
  const note=noteEl().value;
  if(!w) return;
  data[today]=data[today]||{};
  data[today][who]={w,note};
  localStorage.setItem("data",JSON.stringify(data));
  load();
}

function load(){
  dateEl().innerText=today;
  if(data[today]?.me)
    todayEl().innerText=data[today].me.w+" kg";
  renderList();
}

function renderList(){
  listEl().innerHTML="";
  Object.keys(data).sort().reverse().forEach(d=>{
    Object.keys(data[d]).forEach(p=>{
      const r=data[d][p];
      const div=document.createElement("div");
      div.className="record";
      div.innerHTML=`<span>${d} Â· ${p} Â· ${r.w}kg ${r.note||""}</span>
      <button onclick="del('${d}','${p}')">åˆ </button>`;
      listEl().appendChild(div);
    });
  });
}

function del(d,p){
  delete data[d][p];
  localStorage.setItem("data",JSON.stringify(data));
  load();
}

function saveSetting(){
  setting.me=meName.value;
  setting.ta=taName.value;
  setting.target=target.value;
  localStorage.setItem("setting",JSON.stringify(setting));
}

function drawChart(){
  const ctx=document.getElementById("chart");
  const labels=[],values=[];
  Object.keys(data).sort().forEach(d=>{
    if(data[d].me){
      labels.push(d);
      values.push(data[d].me.w);
    }
  });
  new Chart(ctx,{
    type:"line",
    data:{labels,datasets:[{data:values,fill:false}]},
    options:{responsive:true}
  });
}

const whoEl=()=>document.getElementById("who");
const weightEl=()=>document.getElementById("weight");
const noteEl=()=>document.getElementById("note");
const todayEl=()=>document.getElementById("today");
const dateEl=()=>document.getElementById("date");
const listEl=()=>document.getElementById("list");

load();
</script>
</body>
</html>
