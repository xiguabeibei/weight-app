<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>å®¶åº­å¥åº·è®°å½•</title>

<style>
:root{
 --bg:#f6f7fb;
 --card:#ffffff;
 --text:#222;
 --primary:#ff8fb1;
}
body.dark{
 --bg:#1e1e2f;
 --card:#2b2b3c;
 --text:#f4f4f5;
}
body{
 margin:0;
 display:flex;
 height:100vh;
 background:var(--bg);
 color:var(--text);
 font-family:-apple-system,"PingFang SC";
}

/* ===== å·¦ä¾§æ  ===== */
aside{
 width:240px;
 padding:16px;
 background:var(--card);
 box-shadow:4px 0 20px rgba(0,0,0,.08);
}
.section-title{
 font-size:14px;
 opacity:.6;
 margin:12px 0 6px;
}
.btn{
 width:100%;
 padding:10px;
 border:none;
 border-radius:12px;
 background:#eee;
 font-size:15px;
}
.btn.primary{
 background:var(--primary);
 color:#fff;
}
.toggle{
 display:flex;
 gap:6px;
}
.toggle button{
 flex:1;
 padding:6px 0;
 border-radius:999px;
 border:none;
 font-size:13px;
}

/* ===== æˆå‘˜åˆ—è¡¨ ===== */
.member-name{
 font-size:17px;
 font-weight:600;
 margin-top:10px;
}
.member-item{
 padding:6px 10px;
 border-radius:10px;
 margin-top:4px;
 cursor:pointer;
 font-size:15px;
}
.member-item:hover{
 background:#eee;
}

/* ===== ä¸»ä½“ ===== */
main{
 flex:1;
 padding:20px;
 overflow:auto;
}
.card{
 background:var(--card);
 border-radius:20px;
 padding:16px;
 margin-bottom:16px;
 box-shadow:0 10px 30px rgba(0,0,0,.08);
}
input,textarea{
 width:100%;
 padding:12px;
 border-radius:12px;
 border:1px solid #ccc;
 margin-bottom:10px;
 font-size:16px;
}
</style>
</head>

<body>

<aside>
<div class="section-title">è®¾ç½®</div>
<button class="btn primary" onclick="openSettings()">æ·»åŠ æˆå‘˜</button>

<div class="toggle" style="margin-top:8px">
<button onclick="setTheme('light')">â˜€ï¸</button>
<button onclick="setTheme('dark')">ğŸŒ™</button>
<button onclick="setTheme('system')">ğŸŒ“</button>
</div>

<div class="section-title">æˆå‘˜</div>
<div id="memberList"></div>
</aside>

<main>
<div id="content"></div>
</main>

<script>
/* ===== æ•°æ® ===== */
let store = JSON.parse(localStorage.getItem("health_ok")||"{}");
let currentUser = null;
let page = "weight";

function save(){
 localStorage.setItem("health_ok",JSON.stringify(store));
}

/* ===== ä¸»é¢˜ ===== */
function setTheme(t){
 localStorage.setItem("theme",t);
 applyTheme();
}
function applyTheme(){
 const t=localStorage.getItem("theme")||"system";
 document.body.classList.toggle("dark",
  t==="dark"||(t==="system"&&matchMedia("(prefers-color-scheme:dark)").matches)
 );
}
applyTheme();

/* ===== æˆå‘˜ ===== */
function renderMembers(){
 memberList.innerHTML="";
 Object.keys(store).forEach(name=>{
  const box=document.createElement("div");
  box.innerHTML=`
   <div class="member-name">${name}</div>
   <div class="member-item" onclick="open('${name}','weight')">ä½“é‡è®°å½•</div>
   <div class="member-item" onclick="open('${name}','food')">é¥®é£Ÿæ‘„å…¥</div>
   <div class="member-item" onclick="open('${name}','sport')">è¿åŠ¨å‡è„‚</div>
  `;
  memberList.appendChild(box);
 });
}
renderMembers();

function open(name,p){
 currentUser=name;
 page=p;
 render();
}

function openSettings(){
 page="settings";
 render();
}

/* ===== é¡µé¢æ¸²æŸ“ ===== */
function render(){
 if(page==="settings"){
  content.innerHTML=`
   <div class="card">
    <h2>æ·»åŠ æˆå‘˜</h2>
    <input id="name" placeholder="æˆå‘˜å">
    <input id="start" placeholder="åˆå§‹ä½“é‡">
    <input id="target" placeholder="ç›®æ ‡ä½“é‡">
    <button class="btn primary" onclick="addMember()">ä¿å­˜</button>
   </div>`;
  return;
 }

 if(!currentUser){
  content.innerHTML="<div class='card'>è¯·å…ˆæ·»åŠ æˆå‘˜</div>";
  return;
 }

 if(page==="weight")renderWeight();
 if(page==="food")renderFood();
 if(page==="sport")renderSport();
}

/* ===== æˆå‘˜æ•°æ® ===== */
function ensure(date){
 store[currentUser].records = store[currentUser].records || {};
 store[currentUser].records[date] =
  store[currentUser].records[date] || {weight:{},foods:[],sports:[]};
}

/* ===== æ·»åŠ æˆå‘˜ ===== */
function addMember(){
 const n=name.value;
 if(!n)return;
 store[n]={profile:{start:+start.value,target:+target.value},records:{}};
 save();
 renderMembers();
 open(n,"weight");
}

/* ===== ä½“é‡ ===== */
function renderWeight(){
 content.innerHTML=`
 <div class="card">
  <h2>ä½“é‡è®°å½•</h2>
  <input type="date" id="date">
  <input id="w" placeholder="ä½“é‡ kg">
  <button class="btn primary" onclick="saveWeight()">ä¿å­˜</button>
 </div>`;
}

function saveWeight(){
 const d=date.value;
 ensure(d);
 store[currentUser].records[d].weight.value = +w.value;
 save();
 alert("å·²ä¿å­˜");
}

/* ===== é¥®é£Ÿ ===== */
function renderFood(){
 content.innerHTML=`
 <div class="card">
  <h2>é¥®é£Ÿæ‘„å…¥</h2>
  <textarea id="food" placeholder="é£Ÿç‰© + å¡è·¯é‡Œ"></textarea>
  <button class="btn primary" onclick="saveFood()">ä¿å­˜</button>
 </div>`;
}
function saveFood(){
 const d=new Date().toISOString().slice(0,10);
 ensure(d);
 store[currentUser].records[d].foods.push(food.value);
 save();
 alert("å·²ä¿å­˜");
}

/* ===== è¿åŠ¨ ===== */
function renderSport(){
 content.innerHTML=`
 <div class="card">
  <h2>è¿åŠ¨å‡è„‚</h2>
  <input id="sport" placeholder="è¿åŠ¨ + å¡è·¯é‡Œ">
  <button class="btn primary" onclick="saveSport()">ä¿å­˜</button>
 </div>`;
}
function saveSport(){
 const d=new Date().toISOString().slice(0,10);
 ensure(d);
 store[currentUser].records[d].sports.push(sport.value);
 save();
 alert("å·²ä¿å­˜");
}

render();
</script>

</body>
</html>
