<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="å¥åº·è®°å½•">
<title>å¥åº·è®°å½•</title>

<style>
body{
 margin:0;
 font-family:-apple-system,BlinkMacSystemFont,"PingFang SC";
 background:#f6f7fb;
 color:#222;
}
header{
 height:56px;
 display:flex;
 align-items:center;
 justify-content:space-between;
 padding:0 16px;
 background:#fff;
 box-shadow:0 4px 20px rgba(0,0,0,.08);
}
header button{border:none;background:none;font-size:20px;}
main{padding:16px;}
.card{
 background:#fff;
 border-radius:20px;
 padding:16px;
 margin-bottom:16px;
 box-shadow:0 12px 30px rgba(0,0,0,.1);
}
h2{margin:0 0 12px;}
input{
 width:100%;
 padding:14px;
 border-radius:14px;
 border:1px solid #ddd;
 margin-bottom:10px;
 font-size:16px;
}
button.primary{
 width:100%;
 padding:14px;
 border:none;
 border-radius:999px;
 background:linear-gradient(135deg,#ff8fb1,#a78bfa);
 color:#fff;
 font-size:16px;
}
.item{display:flex;gap:8px;margin-bottom:8px;}
.item input{flex:1;}
canvas{width:100%;height:220px;}
</style>
</head>

<body>

<header>
<button onclick="toggleMenu()">â˜°</button>
<div id="userName">æœªé€‰æ‹©æˆå‘˜</div>
<button onclick="showPage('settings')">âš™ï¸</button>
</header>

<main id="menu" style="display:none">
<div class="card">
<button class="primary" onclick="showPage('weight')">âš–ï¸ ä½“é‡</button><br><br>
<button class="primary" onclick="showPage('food')">ğŸš é¥®é£Ÿ</button><br><br>
<button class="primary" onclick="showPage('sport')">ğŸƒ è¿åŠ¨</button>
</div>
</main>

<main id="content">

<div class="card">
<input type="date" id="date">
<button onclick="timeType='am'">ğŸŒ… æ—©</button>
<button onclick="timeType='pm'">ğŸŒ™ æ™š</button>
</div>

<!-- ä½“é‡ -->
<div id="weight" class="card">
<h2>ä½“é‡</h2>
<input type="number" id="weightVal" placeholder="ä½“é‡ kg">
<button class="primary" onclick="saveWeight()">ä¿å­˜ä½“é‡</button>
<canvas id="weightChart"></canvas>
</div>

<!-- é¥®é£Ÿ -->
<div id="food" class="card" style="display:none">
<h2>é¥®é£Ÿ</h2>
<div id="foods"></div>
<button onclick="addFood()">â• æ·»åŠ é£Ÿç‰©</button>
<button class="primary" onclick="saveFood()">ä¿å­˜é¥®é£Ÿ</button>
<div id="foodTotal"></div>
<canvas id="foodChart"></canvas>
</div>

<!-- è¿åŠ¨ -->
<div id="sport" class="card" style="display:none">
<h2>è¿åŠ¨</h2>
<div id="sports"></div>
<button onclick="addSport()">â• æ·»åŠ è¿åŠ¨</button>
<button class="primary" onclick="saveSport()">ä¿å­˜è¿åŠ¨</button>
<div id="sportTotal"></div>
</div>

<!-- è®¾ç½® -->
<div id="settings" class="card" style="display:none">
<h2>æˆå‘˜è®¾ç½®</h2>
<input id="memberName" placeholder="æˆå‘˜å">
<input id="startWeight" placeholder="åˆå§‹ä½“é‡">
<input id="targetWeight" placeholder="ç›®æ ‡ä½“é‡">
<button class="primary" onclick="saveMember()">ä¿å­˜æˆå‘˜</button>
</div>

</main>

<script>
let store=JSON.parse(localStorage.getItem("healthPro")||"{}");
let currentUser=Object.keys(store)[0]||"";
let timeType="pm";
date.value=new Date().toISOString().slice(0,10);

function saveStore(){
 localStorage.setItem("healthPro",JSON.stringify(store));
}

function toggleMenu(){
 menu.style.display=menu.style.display?"":"block";
}

function showPage(id){
 ["weight","food","sport","settings"].forEach(p=>{
  document.getElementById(p).style.display="none";
 });
 document.getElementById(id).style.display="block";
 menu.style.display="none";
}

function ensure(){
 if(!currentUser)return;
 store[currentUser].records=store[currentUser].records||{};
 store[currentUser].records[date.value]=
 store[currentUser].records[date.value]||{
  am:{},pm:{},
  foods:[],foodTotal:0,
  sport:[],sportTotal:0
 };
}

function saveWeight(){
 ensure();
 store[currentUser].records[date.value][timeType].weight=Number(weightVal.value);
 saveStore();drawWeight();
}

function addFood(){
 const d=document.createElement("div");
 d.className="item";
 d.innerHTML='<input placeholder="é£Ÿç‰©"><input type="number" placeholder="kcal">';
 foods.appendChild(d);
}

function saveFood(){
 ensure();
 let total=0;
 store[currentUser].records[date.value].foods=
 [...foods.children].map(f=>{
  const kcal=Number(f.children[1].value||0);
  total+=kcal;
  return {name:f.children[0].value,kcal};
 });
 store[currentUser].records[date.value].foodTotal=total;
 foodTotal.innerText="ä»Šæ—¥æ‘„å…¥ï¼š"+total+" kcal";
 saveStore();drawFood();
}

function addSport(){
 const d=document.createElement("div");
 d.className="item";
 d.innerHTML='<input placeholder="è¿åŠ¨"><input type="number" placeholder="kcal">';
 sports.appendChild(d);
}

function saveSport(){
 ensure();
 let total=0;
 store[currentUser].records[date.value].sport=
 [...sports.children].map(s=>{
  const kcal=Number(s.children[1].value||0);
  total+=kcal;
  return {name:s.children[0].value,kcal};
 });
 store[currentUser].records[date.value].sportTotal=total;
 sportTotal.innerText="ä»Šæ—¥æ¶ˆè€—ï¼š"+total+" kcal";
 saveStore();
}

function saveMember(){
 const n=memberName.value;
 if(!n)return;
 store[n]={profile:{
  start:Number(startWeight.value),
  target:Number(targetWeight.value)
 },records:{}};
 currentUser=n;
 userName.innerText=n;
 saveStore();showPage('weight');
}

function drawWeight(){
 const ctx=weightChart.getContext("2d");
 ctx.clearRect(0,0,300,300);
 if(!currentUser)return;
 const vals=Object.values(store[currentUser].records)
  .map(d=>d[timeType].weight).filter(Boolean);
 if(!vals.length)return;
 ctx.beginPath();
 vals.forEach((v,i)=>{
  const x=i*(300/vals.length);
  const y=220-(v/Math.max(...vals))*180;
  i?ctx.lineTo(x,y):ctx.moveTo(x,y);
 });
 ctx.strokeStyle="#ff8fb1";
 ctx.lineWidth=3;
 ctx.stroke();
}

function drawFood(){
 const ctx=foodChart.getContext("2d");
 ctx.clearRect(0,0,300,300);
 const vals=Object.values(store[currentUser].records)
  .slice(-30).map(d=>d.foodTotal||0);
 if(!vals.length)return;
 ctx.beginPath();
 vals.forEach((v,i)=>{
  const x=i*(300/vals.length);
  const y=220-(v/Math.max(...vals))*180;
  i?ctx.lineTo(x,y):ctx.moveTo(x,y);
 });
 ctx.strokeStyle="#67e8f9";
 ctx.lineWidth=3;
 ctx.stroke();
}
</script>

</body>
</html>
