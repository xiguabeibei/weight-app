<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA / iOS App å¤–è§‚ -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="ä½“é‡æœ¬" />

  <title>ä½“é‡æœ¬ ğŸ’—</title>

  <style>
    body {
      margin: 0;
      background: #fff7fb;
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
    }

    .app {
      padding: 20px;
      padding-bottom: 90px;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 12px;
    }

    .card {
      background: #fff;
      border-radius: 22px;
      padding: 18px;
      margin-bottom: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    }

    input, select {
      width: 100%;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid #eee;
      font-size: 16px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      padding: 14px;
      border-radius: 999px;
      background: #ff8fb1;
      color: #fff;
      border: none;
      font-size: 16px;
    }

    .big {
      font-size: 36px;
      font-weight: bold;
      color: #ff8fb1;
    }

    .tip {
      font-size: 14px;
      color: #999;
      margin-top: 4px;
    }

    .record {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }

    .record button {
      width: auto;
      padding: 6px 12px;
      font-size: 12px;
      background: #eee;
      color: #666;
    }

    .tabs {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      background: #fff;
      border-top: 1px solid #eee;
    }

    .tabs button {
      flex: 1;
      background: none;
      border: none;
      padding: 12px;
      font-size: 14px;
    }

    .page { display: none; }
    .page.active { display: block; }
  </style>
</head>

<body>
<div class="app">

  <!-- ä»Šæ—¥ -->
  <div class="page active" id="home">
    <h1>ä»Šå¤© ğŸŒ·</h1>
    <div class="card">
      <select id="who">
        <option value="me">æˆ‘</option>
        <option value="ta">TA</option>
      </select>
      <input id="weight" type="number" step="0.1" placeholder="ä½“é‡ kg" />
      <input id="note" placeholder="å¤‡æ³¨ï¼ˆåƒå¤šäº† / è¿åŠ¨äº†ï¼‰" />
      <button onclick="save()">ä¿å­˜</button>
      <div class="big" id="today">-- kg</div>
      <div class="tip" id="date"></div>
    </div>
  </div>

  <!-- è®°å½• -->
  <div class="page" id="listPage">
    <h1>è®°å½• ğŸ“–</h1>
    <div class="card" id="list"></div>
  </div>

  <!-- è¶‹åŠ¿ -->
  <div class="page" id="chartPage">
    <h1>è¶‹åŠ¿ ğŸ“ˆ</h1>
    <div class="card">
      <canvas id="chart"></canvas>
    </div>
  </div>

  <!-- è®¾ç½® -->
  <div class="page" id="setting">
    <h1>è®¾ç½® âš™ï¸</h1>
    <div class="card">
      <input id="meName" placeholder="æˆ‘çš„æ˜µç§°" />
      <input id="taName" placeholder="TA çš„æ˜µç§°" />
      <input id="target" placeholder="ç›®æ ‡ä½“é‡ kg" />
      <button onclick="saveSetting()">ä¿å­˜è®¾ç½®</button>
    </div>
  </div>

</div>

<!-- åº•éƒ¨å¯¼èˆª -->
<div class="tabs">
  <button onclick="show('home')">ğŸ </button>
  <button onclick="show('listPage')">ğŸ“–</button>
  <button onclick="show('chartPage')">ğŸ“ˆ</button>
  <button onclick="show('setting')">âš™ï¸</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const today = new Date().toISOString().slice(0,10);
const data = JSON.parse(localStorage.getItem("data") || "{}");
const setting = JSON.parse(localStorage.getItem("setting") || "{}");

function show(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(id==="chartPage") drawChart();
}

function save(){
  const who = document.getElementById("who").value;
  const w = document.getElementById("weight").value;
  const note = document.getElementById("note").value;
  if(!w) return;

  data[today] = data[today] || {};
  data[today][who] = { w, note };
  localStorage.setItem("data", JSON.stringify(data));
  load();
}

function load(){
  document.getElementById("date").innerText = today;
  const t = data[today]?.me?.w;
  if(t) document.getElementById("today").innerText = t + " kg";

  const list = document.getElementById("list");
  list.innerHTML = "";
  Object.keys(data).sort().reverse().forEach(d=>{
    Object.keys(data[d]).forEach(p=>{
      const r = data[d][p];
      const div = document.createElement("div");
      div.className="record";
      div.innerHTML = `<span>${d} ${p} ${r.w}kg ${r.note||""}</span>
        <button onclick="del('${d}','${p}')">åˆ </button>`;
      list.appendChild(div);
    });
  });
}

function del(d,p){
  delete data[d][p];
  localStorage.setItem("data", JSON.stringify(data));
  load();
}

function saveSetting(){
  setting.me = document.getElementById("meName").value;
  setting.ta = document.getElementById("taName").value;
  setting.target = document.getElementById("target").value;
  localStorage.setItem("setting", JSON.stringify(setting));
}

function drawChart(){
  const ctx = document.getElementById("chart");
  const labels=[], values=[];
  Object.keys(data).sort().forEach(d=>{
    if(data[d].me){
      labels.push(d);
      values.push(data[d].me.w);
    }
  });
  new Chart(ctx,{
    type:"line",
    data:{labels,datasets:[{data:values,fill:false}]},
    options:{responsive:true}
  });
}

load();
</script>
</body>
</html>
