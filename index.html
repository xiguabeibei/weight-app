<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> <meta name="apple-mobile-web-app-title" content="ç¼¤çº·æ—¥è®°"> <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3069/3069172.png"> <title>ä¸ƒå½©æ¢¦å¹»å¥èº«æ—¥è®°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+SC:wght@400;900&display=swap');
        
        body { 
            background: linear-gradient(-45deg, #fff0f3, #e7f5ff, #f3f0ff, #fff9db);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: #444;
            font-family: 'Noto Sans SC', sans-serif;
            overflow: hidden;
            perspective: 1000px;
            /* ç¡®ä¿åœ¨å…¨å±æ¨¡å¼ä¸‹é«˜åº¦æ’‘æ»¡ */
            height: 100vh;
            width: 100vw;
        }

        @keyframes gradientBG { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }

        .sakura { position: fixed; top: -10%; z-index: -1; pointer-events: none; animation: fall linear infinite; }
        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }

        .floating-card {
            background: rgba(255, 255, 255, 0.85);
            border: 4px solid white;
            backdrop-filter: blur(15px);
            border-radius: 2.5rem;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
            animation: float 6s ease-in-out infinite;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .card-blue { border-color: #bae1ff; box-shadow: 0 10px 30px rgba(186, 225, 255, 0.4); }
        .card-green { border-color: #baffc9; box-shadow: 0 10px 30px rgba(186, 255, 201, 0.4); }
        .card-purple { border-color: #decaff; box-shadow: 0 10px 30px rgba(222, 202, 255, 0.4); }
        .card-yellow { border-color: #ffffba; box-shadow: 0 10px 30px rgba(255, 255, 186, 0.4); }
        .card-orange { border-color: #ffdfba; box-shadow: 0 10px 30px rgba(255, 223, 186, 0.4); }

        .glow-bar {
            background: linear-gradient(90deg, #4dabf7, #3bc9db, #4dabf7);
            background-size: 200% auto;
            animation: moveGradient 2s linear infinite;
        }
        @keyframes moveGradient { to { background-position: 200% center; } }

        .swipe-container { position: relative; overflow: hidden; touch-action: pan-x; border-radius: 1.5rem; margin-bottom: 1rem; background: #ff6b6b !important; }
        .swipe-content { position: relative; z-index: 20; transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.2); background: white !important; width: 100%; }
        .delete-action { position: absolute; right: 0; top: 0; bottom: 0; width: 80px; color: white; display: flex; align-items: center; justify-content: center; z-index: 10; font-weight: 900; }

        .btn-pop { background: #444; color: white; transition: all 0.2s; }
        .btn-pop:active { transform: scale(0.85); }
        .sidebar-active { background: #444 !important; color: white !important; transform: translateX(10px); }

        .text-pop { font-family: 'ZCOOL KuaiLe', cursive; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="flex h-screen p-4 gap-6">

    <div id="sakura-container"></div>

    <aside class="w-72 flex flex-col p-6 floating-card">
        <div class="flex flex-col items-center gap-2 mb-10">
            <div class="w-16 h-16 rounded-3xl bg-gradient-to-br from-yellow-300 to-orange-400 flex items-center justify-center shadow-2xl rotate-12 text-white"><i data-lucide="star" class="fill-current"></i></div>
            <h1 class="text-pop text-2xl mt-2 tracking-widest text-orange-500">ç¼¤çº·æ—¥è®°</h1>
        </div>
        <nav id="user-nav" class="flex-1 space-y-3 overflow-y-auto no-scrollbar px-2"></nav>
        <div class="pt-6 border-t-2 border-dashed border-gray-100 space-y-3">
            <button onclick="addUser()" class="w-full p-4 rounded-2xl bg-green-400 text-white flex items-center justify-center gap-3 font-black shadow-lg active:scale-95 transition-all"><i data-lucide="plus-circle"></i> æ–°æˆå‘˜</button>
            <button onclick="openManageModal()" class="w-full p-4 rounded-2xl text-gray-400 font-bold hover:bg-gray-50 flex items-center justify-center gap-3 transition-all"><i data-lucide="settings"></i> æ¡£æ¡ˆè®¾ç½®</button>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto no-scrollbar space-y-8 pb-10">
        <section class="floating-card card-blue p-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-pop text-lg flex items-center gap-2 text-blue-500">ğŸ’ å‡é‡è¿›åŒ–é‡Œç¨‹ç¢‘</h3>
                <div class="bg-blue-100 text-blue-600 px-4 py-1 rounded-full text-xs font-black" id="progress-percent">0%</div>
            </div>
            <div class="relative w-full h-8 bg-blue-50 rounded-full p-1.5 overflow-hidden border border-blue-100">
                <div id="progress-bar" class="glow-bar h-full rounded-full w-0 transition-all duration-1000 shadow-inner"></div>
            </div>
            <div class="grid grid-cols-2 mt-4">
                <div class="text-left"><p class="text-[10px] opacity-40 font-black">èµ·ç‚¹ä½“é‡</p><p class="text-xl font-black text-blue-400" id="start-w">-- KG</p></div>
                <div class="text-right"><p class="text-[10px] opacity-40 font-black">ç»ˆç‚¹ç›®æ ‡</p><p class="text-xl font-black text-blue-600" id="target-w">-- KG</p></div>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <section class="lg:col-span-2 floating-card card-green p-10 relative overflow-hidden group">
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-green-50 rounded-full opacity-50 group-hover:scale-150 transition-all duration-700"></div>
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <div class="flex items-center gap-6 mb-4">
                            <h2 id="display-name" class="text-pop text-6xl tracking-tighter text-green-600">--</h2>
                            <div id="display-gender-icon" class="animate-bounce"></div>
                        </div>
                        <div class="inline-block bg-green-500 text-white px-4 py-1 rounded-lg text-xs font-black shadow-lg" id="display-wish">--</div>
                    </div>
                    <div class="text-right">
                        <div id="status-tag" class="text-7xl text-pop leading-none text-green-500">0.0</div>
                        <p class="text-xs font-black opacity-30 mt-2 italic tracking-widest text-green-700">KG REMAINING</p>
                    </div>
                </div>
                <div id="mood-display" class="mt-8 p-5 rounded-3xl bg-white/60 border-2 border-dashed border-green-200 text-sm font-bold italic text-green-700 shadow-inner">âœ¨ çŠ¶æ€: --</div>
            </section>

            <section class="floating-card card-purple p-8 flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h4 class="text-pop text-lg flex items-center gap-2 text-purple-500"><i data-lucide="sparkles"></i> æ¯æ—¥ä¹ æƒ¯</h4>
                    <button onclick="addInterest()" class="w-10 h-10 rounded-full bg-purple-500 text-white flex items-center justify-center shadow-lg active:scale-90 transition-all"><i data-lucide="plus"></i></button>
                </div>
                <div id="interest-list" class="space-y-4 overflow-y-auto no-scrollbar flex-1"></div>
            </section>
        </div>

        <section class="floating-card card-yellow p-8">
            <div class="flex justify-between items-center mb-10">
                <h3 class="text-pop text-xl flex items-center gap-2 text-yellow-600"><i data-lucide="line-chart"></i> ä½“é‡èƒ½é‡è°±å›¾</h3>
                <div class="flex gap-3">
                    <input type="date" id="chart-start" onchange="renderChart()" class="text-xs p-2 rounded-xl border-yellow-200 border">
                    <input type="date" id="chart-end" onchange="renderChart()" class="text-xs p-2 rounded-xl border-yellow-200 border">
                </div>
            </div>
            <div class="h-80 w-full"><canvas id="weightChart"></canvas></div>
        </section>

        <section class="floating-card card-orange p-8">
            <div class="flex flex-wrap items-center justify-between gap-6 mb-8">
                <div class="flex items-center gap-4 bg-orange-50 p-3 rounded-2xl shadow-inner border-2 border-orange-100">
                    <i data-lucide="calendar" class="text-orange-500"></i>
                    <input type="date" id="global-date" onchange="render()" class="font-black text-xl text-orange-600 bg-transparent border-none">
                </div>
                <div class="flex gap-2 p-2 bg-orange-100 rounded-3xl">
                    <button onclick="setLogType('weight')" id="tab-weight" class="px-8 py-3 rounded-2xl font-black text-xs transition-all">ç§¤ä½“é‡</button>
                    <button onclick="setLogType('food')" id="tab-food" class="px-8 py-3 rounded-2xl font-black text-xs transition-all">èƒ½é‡è¡¥ç»™</button>
                    <button onclick="setLogType('sport')" id="tab-sport" class="px-8 py-3 rounded-2xl font-black text-xs transition-all">å¡è·¯é‡Œç‡ƒçƒ§</button>
                </div>
            </div>
            <div id="entry-form" class="grid grid-cols-1 md:grid-cols-4 gap-6"></div>
        </section>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-10 pb-20">
            <div id="list-food"></div>
            <div id="list-sport"></div>
        </div>
    </main>

    <div id="manage-modal" class="hidden fixed inset-0 bg-black/20 backdrop-blur-xl z-50 flex items-center justify-center p-6">
        <div class="floating-card p-12 w-full max-w-2xl bg-white shadow-2xl">
            <h2 class="text-pop text-3xl mb-10 flex items-center gap-4 text-gray-700"><i data-lucide="award" class="text-yellow-500"></i> æˆå‘˜æ¡£æ¡ˆä¿®æ”¹</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="space-y-2"><label class="text-xs font-black opacity-40 ml-4">ä»£å·</label><input type="text" id="m-name" class="w-full p-5 rounded-2xl bg-gray-50 border-none"></div>
                <div class="space-y-2"><label class="text-xs font-black opacity-40 ml-4">æ€§åˆ«</label><select id="m-gender" class="w-full p-5 rounded-2xl bg-gray-50 border-none"><option value="female">å¥³ç”Ÿ</option><option value="male">ç”·ç”Ÿ</option></select></div>
                <div class="space-y-2"><label class="text-xs font-black opacity-40 ml-4">ç›®æ ‡ä½“é‡ (KG)</label><input type="number" id="m-target" class="w-full p-5 rounded-2xl bg-gray-50 border-none"></div>
                <div class="space-y-2"><label class="text-xs font-black opacity-40 ml-4">å‡é‡æ„¿æœ›</label><input type="text" id="m-wish" class="w-full p-5 rounded-2xl bg-gray-50 border-none"></div>
                <div class="space-y-2 md:col-span-2"><label class="text-xs font-black opacity-40 ml-4">ä»Šæ—¥è§‰æ‚Ÿ</label><textarea id="m-mood" class="w-full p-5 rounded-2xl bg-gray-50 border-none h-24"></textarea></div>
            </div>
            <div class="flex gap-6 mt-12">
                <button onclick="closeManageModal()" class="flex-1 font-black opacity-40">å–æ¶ˆ</button>
                <button onclick="saveUserManage()" class="flex-1 p-6 bg-gray-800 text-white rounded-3xl text-lg font-black shadow-xl active:scale-95 transition-all">ä¿å­˜æ›´æ”¹</button>
            </div>
        </div>
    </div>

    <script>
        let users = JSON.parse(localStorage.getItem('sf_colorful_v1') || '[]');
        let curUid = localStorage.getItem('sf_colorful_uid') || (users[0]?.id || null);
        let entryType = 'weight', chart = null;

        function createSakura() {
            const container = document.getElementById('sakura-container');
            const petal = document.createElement('div');
            petal.className = 'sakura';
            petal.style.left = Math.random() * 100 + 'vw';
            petal.style.width = petal.style.height = Math.random() * 15 + 10 + 'px';
            petal.style.backgroundColor = ['#bae1ff','#baffc9','#ffb3c1','#ffffba'][Math.floor(Math.random()*4)];
            petal.style.borderRadius = '50% 0 50% 50%';
            petal.style.animationDuration = Math.random() * 5 + 5 + 's';
            container.appendChild(petal);
            setTimeout(() => petal.remove(), 10000);
        }
        setInterval(createSakura, 600);

        function sync() {
            localStorage.setItem('sf_colorful_v1', JSON.stringify(users));
            if(curUid) localStorage.setItem('sf_colorful_uid', curUid);
            render();
        }

        let tStart = 0, currentSwipeEl = null;
        document.addEventListener('touchstart', e => {
            const container = e.target.closest('.swipe-container');
            if (container) {
                document.querySelectorAll('.swipe-content').forEach(el => { if(el !== container.querySelector('.swipe-content')) el.style.transform = 'translateX(0)'; });
                tStart = e.touches[0].clientX;
                currentSwipeEl = container.querySelector('.swipe-content');
            }
        });
        document.addEventListener('touchmove', e => {
            if (!currentSwipeEl) return;
            const diff = e.touches[0].clientX - tStart;
            if (diff < 0) currentSwipeEl.style.transform = `translateX(${Math.max(diff, -80)}px)`;
        });
        document.addEventListener('touchend', e => {
            if (!currentSwipeEl) return;
            const diff = e.changedTouches[0].clientX - tStart;
            currentSwipeEl.style.transform = diff < -40 ? `translateX(-80px)` : `translateX(0)`;
            currentSwipeEl = null;
        });

        function addUser() {
            const name = prompt("æˆå‘˜åç§°:"); if(!name) return;
            const u = { id: Date.now(), name, target: 50, gender: 'female', weights: [], logs: [], interests: [] };
            users.push(u); curUid = u.id; sync();
        }

        function deleteItem(id, listType) {
            const u = users.find(x => x.id == curUid);
            if(listType === 'user') { users = users.filter(u => u.id !== id); curUid = users[0]?.id || null; }
            else if(listType === 'interest') u.interests = u.interests.filter(i => i.id !== id);
            else u.logs = u.logs.filter(l => l.id !== id);
            sync();
        }

        function toggleInterest(id) {
            const u = users.find(x => x.id == curUid);
            const i = u.interests.find(i => i.id === id);
            i.paused = !i.paused; sync();
        }

        function submitEntry() {
            const u = users.find(x => x.id == curUid); if(!u) return;
            const date = document.getElementById('global-date').value;
            const slot = document.getElementById('e-slot').value;
            if (entryType === 'weight') {
                const val = parseFloat(document.getElementById('e-val').value);
                if (!val) return;
                const idx = u.weights.findIndex(w => w.date === date && w.slot === slot);
                if (idx > -1) u.weights[idx].val = val;
                else u.weights.push({ id: Date.now(), val, slot, date, ts: new Date(date).getTime() });
            } else {
                const name = document.getElementById('e-name').value, cal = parseInt(document.getElementById('e-cal').value);
                if (!name || isNaN(cal)) return;
                u.logs.unshift({ id: Date.now(), type: entryType, name, cal, slot, date });
            }
            sync();
        }

        function render() {
            document.getElementById('user-nav').innerHTML = users.map(u => `
                <div class="swipe-container">
                    <div class="delete-action" onclick="deleteItem(${u.id}, 'user')">åˆ é™¤</div>
                    <div onclick="curUid=${u.id};sync()" class="swipe-content p-5 cursor-pointer flex items-center gap-4 ${curUid == u.id ? 'sidebar-active shadow-lg' : 'text-gray-400 hover:bg-gray-50'}">
                        <span class="font-black text-sm flex-1">${u.name}</span>
                        <i data-lucide="${u.gender==='male'?'mars':'venus'}" class="w-4 h-4 opacity-40"></i>
                    </div>
                </div>`).join('');
            
            const u = users.find(x => x.id == curUid); 
            if(!u) return;

            const sortedWeights = [...u.weights].sort((a,b)=>a.ts-b.ts);
            const startW = sortedWeights.length > 0 ? sortedWeights[0].val : u.target + 10;
            const curW = sortedWeights.length > 0 ? sortedWeights[sortedWeights.length-1].val : startW;
            const targetW = u.target;
            let progress = startW > targetW ? Math.max(0, Math.min(100, ((startW - curW) / (startW - targetW)) * 100)) : (curW <= targetW ? 100 : 0);

            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('progress-percent').innerText = Math.round(progress) + '%';
            document.getElementById('start-w').innerText = startW + ' KG';
            document.getElementById('target-w').innerText = targetW + ' KG';

            document.getElementById('display-name').innerText = u.name;
            document.getElementById('display-wish').innerText = 'æ„¿æœ›ï¼š' + (u.wish || 'æš‚æ— æ„¿æœ›');
            document.getElementById('mood-display').innerText = `âœ¨ ä»Šæ—¥è§‰æ‚Ÿ: ${u.mood || 'ä¿æŒå¯çˆ±ï¼Œä¿æŒå¥åº·'}`;
            document.getElementById('display-gender-icon').innerHTML = `<i data-lucide="${u.gender==='male'?'mars':'venus'}" class="w-10 h-10 ${u.gender==='male'?'text-blue-400':'text-pink-400'}"></i>`;
            
            const diff = (curW - targetW).toFixed(1);
            const tagEl = document.getElementById('status-tag');
            tagEl.innerText = (diff > 0 ? "+" : "") + diff;

            document.getElementById('interest-list').innerHTML = (u.interests || []).map(i => {
                const days = Math.floor((Date.now() - i.start) / 86400000) + 1;
                return `
                <div class="swipe-container shadow-sm">
                    <div class="delete-action" onclick="deleteItem(${i.id}, 'interest')">åˆ é™¤</div>
                    <div class="swipe-content p-5 border-2 border-purple-50 flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-500 ${i.paused ? 'grayscale' : 'animate-pulse'}">
                            <i data-lucide="zap" class="w-5 h-5"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-black text-sm text-purple-700">${i.name}</div>
                            <div class="text-[10px] opacity-40 font-black">å·²åšæŒ ${days} å¤© ${i.paused ? '(æš‚åœä¸­)' : ''}</div>
                        </div>
                        <button onclick="toggleInterest(${i.id})" class="text-purple-300">
                            <i data-lucide="${i.paused ? 'play' : 'pause'}" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>`;
            }).join('');

            const gDate = document.getElementById('global-date').value;
            const logs = u.logs.filter(l => l.date === gDate);
            const logTpl = (l, color) => `
                <div class="swipe-container shadow-sm">
                    <div class="delete-action" onclick="deleteItem(${l.id}, 'log')">åˆ é™¤</div>
                    <div class="swipe-content p-4 border-2 border-${color}-50 flex justify-between items-center group">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-xl bg-${color}-100 flex items-center justify-center text-${color}-500">
                                <i data-lucide="${l.type==='food'?'coffee':'zap'}" class="w-5 h-5"></i>
                            </div>
                            <div><div class="font-black text-sm">${l.name}</div><div class="text-[9px] opacity-30 font-black">${l.slot}</div></div>
                        </div>
                        <div class="text-right font-black text-${color}-500">${l.cal} KCAL</div>
                    </div>
                </div>`;
            
            document.getElementById('list-food').innerHTML = `<h4 class="text-pop text-orange-500 mb-4 ml-2">ğŸ­ è¡¥ç»™æ¸…å•</h4>` + logs.filter(l=>l.type==='food').map(l=>logTpl(l, 'orange')).join('');
            document.getElementById('list-sport').innerHTML = `<h4 class="text-pop text-blue-500 mb-4 ml-2">ğŸ”¥ ç‡ƒçƒ§æŠ¥å‘Š</h4>` + logs.filter(l=>l.type==='sport').map(l=>logTpl(l, 'blue')).join('');

            renderEntryForm(); renderChart(); lucide.createIcons();
        }

        function setLogType(t) { entryType = t; renderEntryForm(); }
        function renderEntryForm() {
            const container = document.getElementById('entry-form');
            ['weight', 'food', 'sport'].forEach(t => {
                const btn = document.getElementById('tab-'+t);
                const color = t==='weight'?'orange':(t==='food'?'orange':'blue');
                btn.className = entryType === t ? `px-8 py-3 rounded-2xl font-black text-xs bg-${color}-500 text-white shadow-xl scale-110` : `px-8 py-3 rounded-2xl font-black text-xs text-${color}-300`;
            });

            if(entryType === 'weight') {
                container.innerHTML = `<select id="e-slot" class="p-4 rounded-2xl shadow-inner font-black text-xs border-none"><option value="æ™¨é—´">æ—©æ™¨</option><option value="æ™šé—´">ç¡å‰</option></select><input type="number" id="e-val" step="0.1" placeholder="ä½“é‡(KG)" class="p-4 rounded-2xl shadow-inner font-black md:col-span-2 text-xs border-none"><button onclick="submitEntry()" class="p-4 rounded-2xl bg-orange-500 text-white font-black text-xs shadow-lg">è®°å½•</button>`;
            } else {
                const slots = entryType === 'food' ? ["æ—©é¤","åˆé¤","æ™šé¤","é›¶é£Ÿ"] : ["æœ‰æ°§","æ— æ°§","æ‹‰ä¼¸"];
                const colorClass = entryType === 'food' ? 'bg-orange-500' : 'bg-blue-500';
                container.innerHTML = `<select id="e-slot" class="p-4 rounded-2xl shadow-inner font-black text-xs border-none">${slots.map(s=>`<option value="${s}">${s}</option>`).join('')}</select><input type="text" id="e-name" placeholder="åç§°" class="p-4 rounded-2xl shadow-inner font-black text-xs border-none"><input type="number" id="e-cal" placeholder="å¡è·¯é‡Œ" class="p-4 rounded-2xl shadow-inner font-black text-xs border-none"><button onclick="submitEntry()" class="p-4 rounded-2xl ${colorClass} text-white font-black text-xs shadow-lg">æ·»åŠ </button>`;
            }
        }

        function renderChart() {
            const u = users.find(x => x.id == curUid); if(!u || !u.weights.length) return;
            const ctx = document.getElementById('weightChart').getContext('2d');
            if(chart) chart.destroy();
            const sorted = [...u.weights].sort((a,b)=>a.ts-b.ts);
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sorted.map(x => x.date.slice(5) + ' ' + x.slot),
                    datasets: [{ 
                        data: sorted.map(x=>x.val), 
                        borderColor: '#fcc419', borderWidth: 6, tension: 0.4, fill: true,
                        pointRadius: 6, pointBackgroundColor: '#fff',
                        backgroundColor: (context) => {
                            const g = ctx.createLinearGradient(0, 0, 0, 400);
                            g.addColorStop(0, 'rgba(255, 243, 191, 0.6)');
                            g.addColorStop(1, 'rgba(255, 243, 191, 0)');
                            return g;
                        }
                    }]
                },
                options: { 
                    responsive: true, maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { border: { display: false }, grid: { color: '#fff9db' }, ticks: { color: '#fcc419', font: { weight: 'bold' } } },
                        x: { border: { display: false }, grid: { display: false }, ticks: { color: '#fcc419', font: { size: 10 } } }
                    }
                }
            });
        }

        function addInterest() {
            const u = users.find(x => x.id == curUid); if(!u) return;
            const name = prompt("æ–°ä¹ æƒ¯åç§°ï¼š");
            if(name) { u.interests.push({ id: Date.now(), name, start: Date.now(), paused: false }); sync(); }
        }

        function openManageModal() {
            const u = users.find(x => x.id == curUid); if(!u) return;
            document.getElementById('m-name').value = u.name;
            document.getElementById('m-gender').value = u.gender;
            document.getElementById('m-target').value = u.target;
            document.getElementById('m-wish').value = u.wish || '';
            document.getElementById('m-mood').value = u.mood || '';
            document.getElementById('manage-modal').classList.remove('hidden');
        }
        function closeManageModal() { document.getElementById('manage-modal').classList.add('hidden'); }
        function saveUserManage() {
            const u = users.find(x => x.id == curUid);
            u.name = document.getElementById('m-name').value; 
            u.gender = document.getElementById('m-gender').value;
            u.target = parseFloat(document.getElementById('m-target').value);
            u.wish = document.getElementById('m-wish').value; 
            u.mood = document.getElementById('m-mood').value;
            closeManageModal(); sync();
        }

        window.onload = () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('global-date').value = today;
            document.getElementById('chart-end').value = today;
            document.getElementById('chart-start').value = new Date(Date.now() - 30*86400000).toISOString().split('T')[0];
            sync(); 
        };
    </script>
</body>
</html>
