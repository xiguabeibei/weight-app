<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PinkFit - 科技美学记录</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        body { font-family: 'Nunito', sans-serif; background: #fff5f7; color: #5f4b50; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px); border: 1px solid rgba(255,192,203,0.3); }
        .sidebar-active { background: #ff85a2; color: white; box-shadow: 0 8px 15px rgba(255, 133, 162, 0.3); }
        .pink-gradient { background: linear-gradient(135deg, #ff85a2 0%, #ffacc1 100%); }
        .progress-bar-bg { background: #ffe4e9; height: 24px; border-radius: 50px; overflow: hidden; position: relative; }
        .progress-fill { background: linear-gradient(90deg, #ff85a2, #f472b6); transition: width 1s ease-in-out; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #ffc0cb; border-radius: 10px; }
        input, select { border: 2px solid transparent !important; transition: all 0.3s; }
        input:focus, select:focus { border-color: #ff85a2 !important; outline: none; background: white !important; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 glass m-4 mr-0 rounded-[2.5rem] flex flex-col p-6 shadow-lg border-pink-100">
        <div class="flex items-center gap-3 mb-10 px-2">
            <div class="w-10 h-10 pink-gradient rounded-xl flex items-center justify-center text-white shadow-md"><i data-lucide="heart"></i></div>
            <h1 class="font-900 text-xl tracking-tight text-pink-500">PinkFit</h1>
        </div>
        <nav id="user-nav" class="flex-1 space-y-3 overflow-y-auto custom-scrollbar"></nav>
        <button onclick="openUserModal()" class="mt-4 p-4 border-2 border-dashed border-pink-200 rounded-2xl text-pink-400 hover:bg-pink-50 flex items-center justify-center gap-2 font-bold transition-all">
            <i data-lucide="plus-circle"></i> 新成员
        </button>
    </aside>

    <main class="flex-1 overflow-y-auto p-4 md:p-6 custom-scrollbar">
        <div class="max-w-6xl mx-auto space-y-6">
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="glass p-8 rounded-[3rem] shadow-sm flex flex-col justify-between min-h-[320px]">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 id="display-name" class="text-3xl font-900 text-pink-600">--</h2>
                            <p class="text-pink-300 font-bold mt-1 text-lg">目标: <span id="tar-w-txt">0</span>kg</p>
                        </div>
                        <div class="text-right">
                            <span id="status-tag" class="text-5xl font-black tabular-nums">0.0</span>
                            <p class="text-[10px] font-bold text-pink-300 uppercase tracking-widest mt-1">距离目标 Distance</p>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <div class="flex justify-between text-xs font-bold mb-2 text-pink-400">
                            <span>暴瘦进度</span>
                            <span id="prog-percent">0%</span>
                        </div>
                        <div class="progress-bar-bg shadow-inner">
                            <div id="progress-fill" class="progress-fill h-full w-0"></div>
                        </div>
                        <p id="motivate-txt" class="mt-6 text-center font-black text-xl italic py-3 rounded-2xl animate-bounce tracking-wide"></p>
                    </div>
                </div>

                <div class="glass p-8 rounded-[3rem] shadow-sm">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-black text-pink-600 flex items-center gap-2"><i data-lucide="line-chart"></i> 体重曲线</h3>
                        <div class="flex bg-pink-50 p-1 rounded-xl text-xs font-bold" id="ranges">
                            <button onclick="updateRange(7)" id="r7" class="px-4 py-2 rounded-lg">7天</button>
                            <button onclick="updateRange(30)" id="r30" class="px-4 py-2 rounded-lg">30天</button>
                        </div>
                    </div>
                    <div class="h-56 w-full"><canvas id="weightChart"></canvas></div>
                </div>
            </div>

            <div class="glass p-8 rounded-[3rem] shadow-sm border-2 border-pink-100">
                <div class="flex flex-wrap items-center gap-4 mb-8">
                    <h3 class="font-black text-pink-600 text-xl flex items-center gap-2"><i data-lucide="edit-3"></i> 记录中心</h3>
                    <input type="date" id="global-date" class="bg-white px-4 py-2 rounded-xl font-bold text-pink-500 border border-pink-100 shadow-sm">
                    <div class="flex gap-2 bg-pink-50/50 p-1 rounded-2xl">
                        <button onclick="setLogType('weight')" id="tab-weight" class="px-6 py-2 rounded-xl font-black text-sm transition-all">体重暴瘦</button>
                        <button onclick="setLogType('food')" id="tab-food" class="px-6 py-2 rounded-xl font-black text-sm transition-all">饮食摄入</button>
                        <button onclick="setLogType('sport')" id="tab-sport" class="px-6 py-2 rounded-xl font-black text-sm transition-all">运动燃脂</button>
                    </div>
                </div>

                <div id="entry-form" class="grid grid-cols-1 md:grid-cols-4 gap-4 p-2">
                    </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-10">
                <div class="glass rounded-[3rem] p-8 shadow-sm">
                    <h4 class="font-black text-pink-500 mb-6 flex items-center gap-2 text-lg"><i data-lucide="coffee"></i> 饮食记录清单</h4>
                    <div id="list-food" class="space-y-3 custom-scrollbar overflow-y-auto max-h-[400px]"></div>
                </div>
                <div class="glass rounded-[3rem] p-8 shadow-sm">
                    <h4 class="font-black text-pink-400 mb-6 flex items-center gap-2 text-lg"><i data-lucide="flame"></i> 燃脂记录清单</h4>
                    <div id="list-sport" class="space-y-3 custom-scrollbar overflow-y-auto max-h-[400px]"></div>
                </div>
            </div>
        </div>
    </main>

    <div id="u-modal" class="hidden fixed inset-0 bg-pink-900/20 backdrop-blur-md z-50 flex items-center justify-center p-6">
        <div class="bg-white rounded-[3rem] p-10 w-full max-w-md shadow-2xl border-4 border-pink-50">
            <h2 class="text-2xl font-900 mb-8 text-pink-600 text-center">遇见更好的自己</h2>
            <div class="space-y-5">
                <input type="text" id="nu-name" placeholder="名字/昵称" class="w-full bg-pink-50/50 p-5 rounded-2xl font-bold text-lg">
                <input type="number" id="nu-target" placeholder="目标体重 (kg)" class="w-full bg-pink-50/50 p-5 rounded-2xl font-bold text-lg">
                <div class="flex gap-4 pt-4">
                    <button onclick="closeUserModal()" class="flex-1 font-bold text-pink-300">取消</button>
                    <button onclick="addUser()" class="flex-1 p-5 pink-gradient text-white rounded-[1.5rem] font-black shadow-lg">开始蜕变</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let users = JSON.parse(localStorage.getItem('sf_pink_v1') || '[]');
        let curUid = localStorage.getItem('sf_pink_uid') || null;
        let activeRange = 30;
        let entryType = 'weight'; 
        let chart = null;

        const quotes = [
            { t: "你流下的汗水，都是照亮未来的光！", c: "text-orange-500" },
            { t: "每一克消失的脂肪，都是你变强的勋章！", c: "text-rose-500" },
            { t: "别低头，皇冠会掉；别停下，目标就在前方！", c: "text-fuchsia-600" },
            { t: "今天也要元气满满地变瘦呀！", c: "text-pink-500" },
            { t: "管住嘴迈开腿，明天你是最美/最帅的！", c: "text-purple-600" }
        ];

        document.getElementById('global-date').valueAsDate = new Date();

        function sync() {
            localStorage.setItem('sf_pink_v1', JSON.stringify(users));
            if(curUid) localStorage.setItem('sf_pink_uid', curUid);
            render();
        }

        function addUser() {
            const name = document.getElementById('nu-name').value, target = parseFloat(document.getElementById('nu-target').value);
            if(!name || !target) return;
            const u = { id: Date.now(), name, target, weights: [], logs: [] };
            users.push(u); curUid = u.id;
            closeUserModal(); sync();
        }

        function setLogType(t) { entryType = t; renderEntryForm(); }

        function renderEntryForm() {
            const container = document.getElementById('entry-form');
            const btns = { weight: 'tab-weight', food: 'tab-food', sport: 'tab-sport' };
            Object.keys(btns).forEach(k => {
                document.getElementById(btns[k]).className = k === entryType 
                    ? "px-6 py-2 rounded-xl font-black text-sm bg-pink-500 text-white shadow-md" 
                    : "px-6 py-2 rounded-xl font-black text-sm text-pink-300 hover:text-pink-500 transition-all";
            });

            if(entryType === 'weight') {
                container.innerHTML = `
                    <select id="e-slot" class="bg-pink-50/50 p-4 rounded-2xl font-bold"><option value="morning">晨间 AM</option><option value="evening">晚间 PM</option></select>
                    <input type="number" id="e-val" step="0.1" placeholder="体重 (kg)" class="bg-pink-50/50 p-4 rounded-2xl font-bold md:col-span-2">
                    <button onclick="submitEntry()" class="pink-gradient text-white p-4 rounded-2xl font-black shadow-md active:scale-95 transition-all">记录暴瘦</button>
                `;
            } else {
                const isFood = entryType === 'food';
                container.innerHTML = `
                    <select id="e-slot" class="bg-pink-50/50 p-4 rounded-2xl font-bold">
                        <option value="早起">早餐/早起</option><option value="中午">午餐</option><option value="下午茶">下午茶</option><option value="晚上">晚餐</option><option value="宵夜">宵夜</option>
                    </select>
                    <input type="text" id="e-name" placeholder="内容" class="bg-pink-50/50 p-4 rounded-2xl font-bold">
                    <input type="number" id="e-cal" placeholder="卡路里" class="bg-pink-50/50 p-4 rounded-2xl font-bold">
                    <button onclick="submitEntry()" class="pink-gradient text-white p-4 rounded-2xl font-black shadow-md active:scale-95 transition-all">${isFood ? '记录饮食' : '记录燃脂'}</button>
                `;
            }
        }

        function submitEntry() {
            const u = users.find(x => x.id == curUid);
            if(!u) return;
            const date = document.getElementById('global-date').value, slot = document.getElementById('e-slot').value;

            if(entryType === 'weight') {
                const val = parseFloat(document.getElementById('e-val').value);
                if(!val) return;
                const exist = u.weights.find(x => x.date === date && x.slot === slot);
                if(exist) exist.val = val; 
                else u.weights.push({ id: Date.now(), val, slot, date, ts: new Date(date).getTime() + (slot === 'morning' ? 0 : 43200) });
                u.weights.sort((a,b) => a.ts - b.ts);
            } else {
                const name = document.getElementById('e-name').value, cal = parseInt(document.getElementById('e-cal').value);
                if(!name || !cal) return;
                u.logs.unshift({ id: Date.now(), type: entryType, name, cal, slot, date });
            }
            sync();
        }

        // 修改功能
        function deleteItem(type, id) {
            if(!confirm("确定要删除这条记录吗？")) return;
            const u = users.find(x => x.id == curUid);
            if(type === 'weight') u.weights = u.weights.filter(x => x.id !== id);
            else u.logs = u.logs.filter(x => x.id !== id);
            sync();
        }

        function editItem(type, id) {
            const u = users.find(x => x.id == curUid);
            let item, newVal;
            if(type === 'weight') {
                item = u.weights.find(x => x.id === id);
                newVal = prompt("修改体重 (kg):", item.val);
                if(newVal) item.val = parseFloat(newVal);
            } else {
                item = u.logs.find(x => x.id === id);
                const newName = prompt("修改名称:", item.name);
                const newCal = prompt("修改卡路里:", item.cal);
                if(newName) item.name = newName;
                if(newCal) item.cal = parseInt(newCal);
            }
            sync();
        }

        function openUserModal() { document.getElementById('u-modal').classList.remove('hidden'); }
        function closeUserModal() { document.getElementById('u-modal').classList.add('hidden'); }
        function updateRange(r) { activeRange = r; render(); }

        function render() {
            const nav = document.getElementById('user-nav');
            nav.innerHTML = users.map(u => `
                <button onclick="curUid=${u.id};sync()" class="w-full flex items-center justify-between p-5 rounded-[1.5rem] transition-all ${curUid == u.id ? 'sidebar-active shadow-lg' : 'text-pink-300 hover:bg-white'}">
                    <span class="font-black text-lg">${u.name}</span>
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </button>
            `).join('');
            
            const u = users.find(x => x.id == curUid);
            if(!u) { renderEntryForm(); return lucide.createIcons(); }

            document.getElementById('display-name').innerText = u.name;
            const curW = u.weights[u.weights.length-1]?.val || 0;
            document.getElementById('tar-w-txt').innerText = u.target;
            
            // 进度条
            const startW = u.weights[0]?.val || curW + 5;
            const percent = Math.min(100, Math.max(10, (Math.abs(startW - curW) / (Math.abs(startW - u.target) || 1)) * 100));
            document.getElementById('progress-fill').style.width = percent + '%';
            document.getElementById('prog-percent').innerText = Math.round(percent) + '%';
            
            const diff = (curW - u.target).toFixed(1);
            const tag = document.getElementById('status-tag');
            tag.innerText = (diff > 0 ? "+" : "") + diff;
            tag.className = diff <= 0 ? "text-5xl font-black text-green-400 tabular-nums" : "text-5xl font-black text-rose-400 tabular-nums";

            const mBox = document.getElementById('motivate-txt');
            const q = quotes[Math.floor(Date.now() / 86400000) % quotes.length]; 
            mBox.innerText = q.t; mBox.className = `mt-6 text-center font-black text-xl italic py-3 rounded-2xl animate-bounce tracking-wide ${q.c}`;

            // 展示区渲染并增加修改/删除按钮
            const gDate = document.getElementById('global-date').value;
            const dayLogs = u.logs.filter(x => x.date === gDate);
            const logItem = (l) => `
                <div class="p-4 glass rounded-[1.5rem] flex justify-between items-center shadow-sm border-pink-50">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center ${l.type==='food'?'bg-orange-100 text-orange-400':'bg-green-100 text-green-400'}">
                            <i data-lucide="${l.type==='food'?'utensils':'zap'}" class="w-4 h-4"></i>
                        </div>
                        <div>
                            <div class="font-black text-slate-600 text-sm">${l.name}</div>
                            <div class="text-[10px] font-bold text-pink-300">${l.slot}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-black text-pink-500">${l.cal} <span class="text-[8px]">kcal</span></span>
                        <button onclick="editItem('log', ${l.id})" class="text-pink-200 hover:text-pink-400"><i data-lucide="edit-2" class="w-3 h-3"></i></button>
                        <button onclick="deleteItem('log', ${l.id})" class="text-pink-200 hover:text-rose-400"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                    </div>
                </div>`;
            
            document.getElementById('list-food').innerHTML = dayLogs.filter(x => x.type === 'food').map(logItem).join('') || '<p class="text-center py-10 text-pink-200 font-bold">无记录</p>';
            document.getElementById('list-sport').innerHTML = dayLogs.filter(x => x.type === 'sport').map(logItem).join('') || '<p class="text-center py-10 text-pink-200 font-bold">无记录</p>';

            [7, 30].forEach(r => document.getElementById(`r${r}`).className = activeRange === r ? "px-4 py-2 bg-white text-pink-500 rounded-lg shadow-sm" : "px-4 py-2 text-pink-200");
            
            renderEntryForm();
            renderChart(u.weights);
            lucide.createIcons();
        }

        function renderChart(ws) {
            const ctx = document.getElementById('weightChart').getContext('2d');
            const cutoff = Date.now() - activeRange * 86400000;
            const f = ws.filter(x => x.ts >= cutoff);
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: f.map(x => x.date.split('-').slice(1).join('/') + ' ' + (x.slot === 'morning' ? 'AM' : 'PM')),
                    datasets: [{
                        data: f.map(x => x.val),
                        borderColor: '#ff85a2', borderWidth: 5, pointRadius: 4, tension: 0.4, fill: true,
                        backgroundColor: (c) => { const g = ctx.createLinearGradient(0,0,0,200); g.addColorStop(0,'rgba(255,133,162,0.2)'); g.addColorStop(1,'transparent'); return g; }
                    }]
                },
                options: { 
                    responsive: true, maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { display: true, grid: { color: '#fff0f3' } },
                        x: { display: true, ticks: { font: { size: 9 }, color: '#ffb3c1' }, grid: { display: false } } 
                    }
                }
            });
        }
        window.onload = render;
    </script>
</body>
</html>
