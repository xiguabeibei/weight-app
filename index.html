<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>健康记录（保存验证版）</title>
<style>
body{
 font-family:-apple-system,"PingFang SC";
 margin:0;display:flex;height:100vh;
 background:#f6f7fb;
}
aside{
 width:220px;padding:16px;background:#fff;
 box-shadow:4px 0 20px rgba(0,0,0,.08);
}
main{flex:1;padding:20px}
button{
 width:100%;padding:10px;margin-top:8px;
 border:none;border-radius:10px;
 background:#ff8fb1;color:#fff;font-size:16px;
}
.card{
 background:#fff;border-radius:16px;
 padding:16px;margin-bottom:16px;
}
input{width:100%;padding:10px;margin-top:8px}
.member{margin-top:8px;cursor:pointer}
</style>
</head>

<body>

<aside>
<button onclick="showAdd()">添加成员</button>
<div id="members"></div>
</aside>

<main>
<div id="content"></div>
</main>

<script>
/* ===== 数据 ===== */
let store = JSON.parse(localStorage.getItem("health_save_test")||"{}");
let currentUser = null;

function save(){
 localStorage.setItem("health_save_test",JSON.stringify(store));
}

/* ===== 工具：安全日期 ===== */
function getDate(){
 return document.getElementById("date")?.value
   || new Date().toISOString().slice(0,10);
}

/* ===== 成员 ===== */
function renderMembers(){
 members.innerHTML="";
 Object.keys(store).forEach(n=>{
  const d=document.createElement("div");
  d.className="member";
  d.innerText=n;
  d.onclick=()=>open(n);
  members.appendChild(d);
 });
}
renderMembers();

function showAdd(){
 content.innerHTML=`
 <div class="card">
  <h2>添加成员</h2>
  <input id="name" placeholder="成员名">
  <button onclick="addMember()">保存</button>
 </div>`;
}

function addMember(){
 const n=name.value;
 if(!n)return;
 store[n]={records:{}};
 save();
 renderMembers();
 open(n);
}

/* ===== 打开成员 ===== */
function open(name){
 currentUser=name;
 renderWeight();
}

/* ===== 体重 ===== */
function renderWeight(){
 content.innerHTML=`
 <div class="card">
  <h2>${currentUser} · 体重记录</h2>
  <input type="date" id="date">
  <input id="w" placeholder="体重 kg">
  <button onclick="saveWeight()">保存体重</button>
 </div>`;
}

function saveWeight(){
 const d=getDate();
 store[currentUser].records[d]={weight:+w.value};
 save();

 alert(
  "已保存 ✅\n\n当前数据：\n"+
  JSON.stringify(store,null,2)
 );
}
</script>

</body>
</html>
