<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PinkFit Pro | 极简记录</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        body { font-family: 'Nunito', sans-serif; background: #f8fafc; color: #334155; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.5); }
        .sidebar-active { background: #f472b6; color: white; box-shadow: 0 10px 15px -3px rgba(244, 114, 182, 0.3); }
        .accent-pink { background: #f472b6; }
        .text-accent { color: #f472b6; }
        .progress-bar-bg { background: #f1f5f9; height: 20px; border-radius: 50px; position: relative; }
        .progress-fill { background: linear-gradient(90deg, #f472b6, #fb923c); transition: width 1s ease; }
        .card-shadow { box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 glass m-4 mr-0 rounded-[2rem] flex flex-col p-6 shadow-sm border-slate-200">
        <div class="flex items-center gap-3 mb-10 px-2">
            <div class="w-10 h-10 accent-pink rounded-xl flex items-center justify-center text-white"><i data-lucide="zap"></i></div>
            <h1 class="font-900 text-xl tracking-tight text-slate-800">PinkFit <span class="text-accent">Pro</span></h1>
        </div>
        <nav id="user-nav" class="flex-1 space-y-2 overflow-y-auto custom-scrollbar"></nav>
        <button onclick="openUserModal()" class="mt-4 p-4 border-2 border-dashed border-slate-200 rounded-2xl text-slate-400 hover:border-pink-300 hover:text-pink-400 flex items-center justify-center gap-2 font-bold transition-all">
            <i data-lucide="user-plus"></i> 新成员
        </button>
    </aside>

    <main class="flex-1 overflow-y-auto p-4 md:p-8 custom-scrollbar">
        <div class="max-w-6xl mx-auto space-y-8">
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-10 rounded-[2.5rem] card-shadow flex flex-col justify-between min-h-[300px]">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 id="display-name" class="text-4xl font-900 text-slate-800 tracking-tight">--</h2>
                            <p class="text-slate-400 font-bold mt-2">目标: <span id="tar-w-txt" class="text-accent">0</span> kg</p>
                        </div>
                        <div class="text-right">
                            <span id="status-tag" class="text-5xl font-black tabular-nums tracking-tighter">0.0</span>
                            <p class="text-[10px] font-black text-slate-300 uppercase mt-1">Gap To Goal</p>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <div class="flex justify-between text-xs font-black mb-3 text-slate-400">
                            <span>蜕变进度</span>
                            <span id="prog-percent" class="text-accent">0%</span>
                        </div>
                        <div class="progress-bar-bg">
                            <div id="progress-fill" class="progress-fill h-full w-0 rounded-full"></div>
                        </div>
                        <p id="motivate-txt" class="mt-6 text-center font-black text-lg italic tracking-wide h-8"></p>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-[2.5rem] card-shadow">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-900 text-slate-700 flex items-center gap-2 text-lg">体重历史趋势</h3>
                        <div class="flex bg-slate-50 p-1 rounded-xl">
                            <button onclick="updateRange(7)" id="r7" class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all">7天</button>
                            <button onclick="updateRange(30)" id="r30" class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all">30天</button>
                        </div>
                    </div>
                    <div class="h-56 w-full"><canvas id="weightChart"></canvas></div>
                </div>
            </div>

            <div class="bg-white p-8 rounded-[2.5rem] card-shadow">
                <div class="flex flex-wrap items-center gap-4 mb-8">
                    <h3 class="font-900 text-slate-800 text-xl flex items-center gap-2">极简记录中心</h3>
                    <input type="date" id="global-date" class="bg-slate-50 px-4 py-2 rounded-xl font-bold text-slate-600 border-none">
                    <div class="flex gap-1 bg-slate-100 p-1 rounded-2xl">
                        <button onclick="setLogType('weight')" id="tab-weight" class="px-6 py-2 rounded-xl font-black text-sm transition-all">体重暴瘦</button>
                        <button onclick="setLogType('food')" id="tab-food" class="px-6 py-2 rounded-xl font-black text-sm transition-all">饮食摄入</button>
                        <button onclick="setLogType('sport')" id="tab-sport" class="px-6 py-2 rounded-xl font-black text-sm transition-all">运动燃脂</button>
                    </div>
                </div>

                <div id="entry-form" class="grid grid-cols-1 md:grid-cols-4 gap-6 p-2">
                    </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pb-20">
                <div class="space-y-4">
                    <h4 class="font-900 text-slate-800 flex items-center gap-2 px-4 italic underline decoration-pink-300">Intake / 饮食清单</h4>
                    <div id="list-food" class="space-y-3 overflow-y-auto max-h-[400px] pr-2 custom-scrollbar"></div>
                </div>
                <div class="space-y-4">
                    <h4 class="font-900 text-slate-800 flex items-center gap-2 px-4 italic underline decoration-orange-300">Burn / 燃脂清单</h4>
                    <div id="list-sport" class="space-y-3 overflow-y-auto max-h-[400px] pr-2 custom-scrollbar"></div>
                </div>
            </div>
        </div>
    </main>

    <div id="u-modal" class="hidden fixed inset-0 bg-slate-900/10 backdrop-blur-sm z-50 flex items-center justify-center p-6">
        <div class="bg-white rounded-[3rem] p-10 w-full max-w-md shadow-2xl">
            <h2 class="text-2xl font-900 mb-8 text-slate-800 text-center">开启记录</h2>
            <div class="space-y-4">
                <input type="text" id="nu-name" placeholder="名字" class="w-full bg-slate-50 p-5 rounded-2xl font-bold">
                <input type="number" id="nu-target" placeholder="目标体重 (kg)" class="w-full bg-slate-50 p-5 rounded-2xl font-bold">
                <div class="flex gap-4 pt-4">
                    <button onclick="closeUserModal()" class="flex-1 font-bold text-slate-400">取消</button>
                    <button onclick="addUser()" class="flex-1 p-5 accent-pink text-white rounded-[1.5rem] font-black">创建</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let users = JSON.parse(localStorage.getItem('sf_pro_v1') || '[]');
        let curUid = localStorage.getItem('sf_pro_uid') || null;
        let activeRange = 30, entryType = 'weight', chart = null;

        const quotes = [
            { t: "今天也要元气满满地变瘦呀！", c: "text-pink-500" },
            { t: "每一克汗水，都是努力的见证！", c: "text-orange-500" },
            { t: "管住嘴迈开腿，明天你最美！", c: "text-rose-600" },
            { t: "生活需要自律，也需要快乐！", c: "text-indigo-500" }
        ];

        document.getElementById('global-date').valueAsDate = new Date();

        function sync() {
            localStorage.setItem('sf_pro_v1', JSON.stringify(users));
            if(curUid) localStorage.setItem('sf_pro_uid', curUid);
            render();
        }

        function addUser() {
            const name = document.getElementById('nu-name').value, target = parseFloat(document.getElementById('nu-target').value);
            if(!name || !target) return;
            const u = { id: Date.now(), name, target, weights: [], logs: [] };
            users.push(u); curUid = u.id;
            closeUserModal(); sync();
        }

        function setLogType(t) { entryType = t; renderEntryForm(); }

        function renderEntryForm() {
            const container = document.getElementById('entry-form');
            const btns = { weight: 'tab-weight', food: 'tab-food', sport: 'tab-sport' };
            Object.keys(btns).forEach(k => {
                document.getElementById(btns[k]).className = k === entryType 
                    ? "px-6 py-2 rounded-xl font-black text-sm bg-white text-pink-500 shadow-sm" 
                    : "px-6 py-2 rounded-xl font-black text-sm text-slate-400 hover:text-slate-600 transition-all";
            });

            if(entryType === 'weight') {
                container.innerHTML = `
                    <select id="e-slot" class="bg-slate-50 p-4 rounded-2xl font-bold border-none"><option value="morning">晨间 (AM)</option><option value="evening">晚间 (PM)</option></select>
                    <input type="number" id="e-val" step="0.1" placeholder="体重数值" class="bg-slate-50 p-4 rounded-2xl font-bold md:col-span-2">
                    <button onclick="submitEntry()" class="accent-pink text-white p-4 rounded-2xl font-black shadow-lg">记录暴瘦</button>
                `;
            } else if(entryType === 'food') {
                container.innerHTML = `
                    <select id="e-slot" class="bg-slate-50 p-4 rounded-2xl font-bold border-none">
                        <option value="早餐">早餐</option><option value="午餐">午餐</option><option value="晚餐">晚餐</option><option value="快乐时间">快乐时间</option>
                    </select>
                    <input type="text" id="e-name" placeholder="吃了什么?" class="bg-slate-50 p-4 rounded-2xl font-bold">
                    <input type="number" id="e-cal" placeholder="卡路里" class="bg-slate-50 p-4 rounded-2xl font-bold">
                    <button onclick="submitEntry()" class="accent-pink text-white p-4 rounded-2xl font-black shadow-lg">记录摄入</button>
                `;
            } else {
                container.innerHTML = `
                    <select id="e-slot" class="bg-slate-50 p-4 rounded-2xl font-bold border-none">
                        <option value="有氧">有氧</option><option value="无氧">无氧</option><option value="无忧躺平">无忧躺平</option>
                    </select>
                    <input type="text" id="e-name" placeholder="什么运动?" class="bg-slate-50 p-4 rounded-2xl font-bold">
                    <input type="number" id="e-cal" placeholder="消耗多少?" class="bg-slate-50 p-4 rounded-2xl font-bold">
                    <button onclick="submitEntry()" class="accent-pink text-white p-4 rounded-2xl font-black shadow-lg">记录燃脂</button>
                `;
            }
        }

        function submitEntry() {
            const u = users.find(x => x.id == curUid);
            if(!u) return;
            const date = document.getElementById('global-date').value, slot = document.getElementById('e-slot').value;

            if(entryType === 'weight') {
                const val = parseFloat(document.getElementById('e-val').value);
                if(!val) return;
                const exist = u.weights.find(x => x.date === date && x.slot === slot);
                if(exist) exist.val = val; 
                else u.weights.push({ id: Date.now(), val, slot, date, ts: new Date(date).getTime() + (slot === 'morning' ? 0 : 43200) });
                u.weights.sort((a,b) => a.ts - b.ts);
            } else {
                const name = document.getElementById('e-name').value, cal = parseInt(document.getElementById('e-cal').value);
                if(!name || !cal) return;
                u.logs.unshift({ id: Date.now(), type: entryType, name, cal, slot, date });
            }
            sync();
        }

        function deleteItem(type, id) {
            if(!confirm("确定删除吗?")) return;
            const u = users.find(x => x.id == curUid);
            if(type === 'weight') u.weights = u.weights.filter(x => x.id !== id);
            else u.logs = u.logs.filter(x => x.id !== id);
            sync();
        }

        function editItem(type, id) {
            const u = users.find(x => x.id == curUid);
            if(type === 'weight') {
                const item = u.weights.find(x => x.id === id);
                const v = prompt("修改体重 (kg):", item.val);
                if(v) item.val = parseFloat(v);
            } else {
                const item = u.logs.find(x => x.id === id);
                const n = prompt("修改名称:", item.name);
                const c = prompt("修改卡路里:", item.cal);
                if(n) item.name = n; if(c) item.cal = parseInt(c);
            }
            sync();
        }

        function openUserModal() { document.getElementById('u-modal').classList.remove('hidden'); }
        function closeUserModal() { document.getElementById('u-modal').classList.add('hidden'); }
        function updateRange(r) { activeRange = r; render(); }

        function render() {
            const nav = document.getElementById('user-nav');
            nav.innerHTML = users.map(u => `<button onclick="curUid=${u.id};sync()" class="w-full flex items-center justify-between p-4 rounded-2xl transition-all ${curUid == u.id ? 'sidebar-active' : 'text-slate-400 hover:bg-slate-100'}"><span class="font-black">${u.name}</span><i data-lucide="chevron-right" class="w-4 h-4"></i></button>`).join('');
            
            const u = users.find(x => x.id == curUid);
            if(!u) { renderEntryForm(); return lucide.createIcons(); }

            document.getElementById('display-name').innerText = u.name;
            const curW = u.weights[u.weights.length-1]?.val || 0;
            document.getElementById('tar-w-txt').innerText = u.target;
            
            const startW = u.weights[0]?.val || curW + 5;
            const percent = Math.min(100, Math.max(10, (Math.abs(startW - curW) / (Math.abs(startW - u.target) || 1)) * 100));
            document.getElementById('progress-fill').style.width = percent + '%';
            document.getElementById('prog-percent').innerText = Math.round(percent) + '%';
            
            const diff = (curW - u.target).toFixed(1);
            const tag = document.getElementById('status-tag');
            tag.innerText = (diff > 0 ? "+" : "") + diff;
            tag.className = diff <= 0 ? "text-5xl font-black text-emerald-400 tracking-tighter" : "text-5xl font-black text-pink-500 tracking-tighter";

            const q = quotes[Math.floor(Date.now() / 86400000) % quotes.length];
            const mBox = document.getElementById('motivate-txt');
            mBox.innerText = q.t; mBox.className = `mt-6 text-center font-black text-lg italic tracking-wide animate-pulse ${q.c}`;

            const gDate = document.getElementById('global-date').value;
            const dayLogs = u.logs.filter(x => x.date === gDate);
            const logItem = (l) => `
                <div class="bg-white p-4 rounded-2xl flex justify-between items-center card-shadow border border-slate-50 group">
                    <div class="flex items-center gap-3">
                        <div class="w-2 h-2 rounded-full ${l.type==='food'?'bg-pink-400':'bg-orange-400'}"></div>
                        <div>
                            <div class="font-black text-slate-700 text-sm">${l.name}</div>
                            <div class="text-[9px] font-bold text-slate-300 uppercase">${l.slot}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-black text-slate-600 text-sm">${l.cal} kcal</span>
                        <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="editItem('log', ${l.id})" class="p-1 hover:text-pink-500"><i data-lucide="edit-3" class="w-3 h-3"></i></button>
                            <button onclick="deleteItem('log', ${l.id})" class="p-1 hover:text-rose-500"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                        </div>
                    </div>
                </div>`;
            
            document.getElementById('list-food').innerHTML = dayLogs.filter(x => x.type === 'food').map(logItem).join('') || '<p class="px-4 py-8 text-slate-300 font-bold text-xs italic">暂无饮食摄入记录</p>';
            document.getElementById('list-sport').innerHTML = dayLogs.filter(x => x.type === 'sport').map(logItem).join('') || '<p class="px-4 py-8 text-slate-300 font-bold text-xs italic">暂无运动燃脂记录</p>';

            [7, 30].forEach(r => document.getElementById(`r${r}`).className = activeRange === r ? "px-4 py-1.5 bg-white text-pink-500 rounded-lg shadow-sm" : "px-4 py-1.5 text-slate-400");
            
            renderEntryForm();
            renderChart(u.weights);
            lucide.createIcons();
        }

        function renderChart(ws) {
            const ctx = document.getElementById('weightChart').getContext('2d');
            const cutoff = Date.now() - activeRange * 86400000;
            const f = ws.filter(x => x.ts >= cutoff);
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: f.map(x => x.date.split('-').slice(1).join('/') + ' ' + (x.slot === 'morning' ? 'AM' : 'PM')),
                    datasets: [{
                        data: f.map(x => x.val),
                        borderColor: '#f472b6', borderWidth: 4, pointRadius: 3, tension: 0.4, fill: true,
                        backgroundColor: (c) => { const g = ctx.createLinearGradient(0,0,0,200); g.addColorStop(0,'rgba(244,114,182,0.1)'); g.addColorStop(1,'transparent'); return g; }
                    }]
                },
                options: { 
                    responsive: true, maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { display: true, grid: { color: '#f8fafc' }, ticks: { font: { size: 10 } } },
                        x: { display: true, ticks: { font: { size: 9 }, color: '#94a3b8' }, grid: { display: false } } 
                    }
                }
            });
        }
        window.onload = render;
    </script>
</body>
</html>
