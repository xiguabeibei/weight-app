<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="å¥åº·è®°å½•">
<title>å¥åº·è®°å½•</title>

<style>
body{
 margin:0;
 font-family:-apple-system,BlinkMacSystemFont,"PingFang SC";
 background:#f6f7fb;
 color:#222;
}
header{
 height:56px;
 display:flex;
 align-items:center;
 justify-content:space-between;
 padding:0 16px;
 background:#fff;
 box-shadow:0 4px 20px rgba(0,0,0,.08);
}
header button{border:none;background:none;font-size:20px;}
main{padding:16px;}
.card{
 background:#fff;
 border-radius:20px;
 padding:16px;
 margin-bottom:16px;
 box-shadow:0 12px 30px rgba(0,0,0,.1);
}
h2{margin:0 0 12px;}
input,select{
 width:100%;
 padding:14px;
 border-radius:14px;
 border:1px solid #ddd;
 margin-bottom:12px;
 font-size:16px;
}
button.primary{
 width:100%;
 padding:14px;
 border:none;
 border-radius:999px;
 background:linear-gradient(135deg,#ff8fb1,#a78bfa);
 color:#fff;
 font-size:16px;
}
.tabs button{
 margin-right:6px;
 padding:6px 12px;
 border-radius:12px;
 border:none;
 background:#eee;
}
canvas{width:100%;height:240px;}
.food-item{
 display:flex;
 gap:8px;
 margin-bottom:8px;
}
.food-item input{flex:1;}
</style>
</head>

<body>

<header>
<button onclick="toggleMenu()">â˜°</button>
<div id="userName">æœªé€‰æ‹©æˆå‘˜</div>
<button onclick="showPage('settings')">âš™ï¸</button>
</header>

<main id="menu" style="display:none">
<div class="card">
<button class="primary" onclick="showPage('weight')">âš–ï¸ ä½“é‡</button><br><br>
<button class="primary" onclick="showPage('food')">ğŸš é¥®é£Ÿ</button>
</div>
</main>

<main id="content">

<div class="card">
<input type="date" id="date">
<div class="tabs">
<button onclick="timeType='am'">ğŸŒ… æ—©</button>
<button onclick="timeType='pm'">ğŸŒ™ æ™š</button>
</div>
</div>

<!-- ä½“é‡ -->
<div id="weight" class="card">
<h2>ä½“é‡è®°å½•</h2>
<input type="number" id="weightVal" placeholder="ä½“é‡ kg">
<button class="primary" onclick="saveWeight()">ä¿å­˜ä½“é‡</button>

<select onchange="range=this.value;drawWeight()" style="margin-top:12px">
<option value="7">7 å¤©</option>
<option value="30">1 ä¸ªæœˆ</option>
<option value="90">3 ä¸ªæœˆ</option>
<option value="180">åŠå¹´</option>
<option value="365">1 å¹´</option>
</select>

<canvas id="weightChart"></canvas>
</div>

<!-- é¥®é£Ÿ -->
<div id="food" class="card" style="display:none">
<h2>é¥®é£Ÿè®°å½•</h2>
<div id="foods"></div>
<button onclick="addFood()">â• æ·»åŠ é£Ÿå“</button>
<button class="primary" onclick="saveFood()">ä¿å­˜é¥®é£Ÿ</button>
<canvas id="foodChart"></canvas>
</div>

<!-- è®¾ç½® -->
<div id="settings" class="card" style="display:none">
<h2>æˆå‘˜è®¾ç½®</h2>
<input id="memberName" placeholder="æˆå‘˜å">
<input id="startWeight" placeholder="åˆå§‹ä½“é‡">
<input id="targetWeight" placeholder="ç›®æ ‡ä½“é‡">
<button class="primary" onclick="saveMember()">ä¿å­˜æˆå‘˜</button>
</div>

</main>

<script>
let store=JSON.parse(localStorage.getItem("healthPro")||"{}");
let currentUser=Object.keys(store)[0]||"";
let timeType="pm";
let range=7;
date.value=new Date().toISOString().slice(0,10);

function saveStore(){
 localStorage.setItem("healthPro",JSON.stringify(store));
}

function toggleMenu(){
 menu.style.display=menu.style.display?"":"block";
}

function showPage(id){
 ["weight","food","settings"].forEach(p=>{
  document.getElementById(p).style.display="none";
 });
 document.getElementById(id).style.display="block";
 menu.style.display="none";
}

function ensure(){
 if(!currentUser)return;
 store[currentUser].records=store[currentUser].records||{};
 store[currentUser].records[date.value]=
 store[currentUser].records[date.value]||{am:{},pm:{},foods:[]};
}

function saveWeight(){
 ensure();
 store[currentUser].records[date.value][timeType].weight=Number(weightVal.value);
 saveStore();
 drawWeight();
}

function addFood(){
 const d=document.createElement("div");
 d.className="food-item";
 d.innerHTML='<input placeholder="é£Ÿç‰©"><input type="number" placeholder="kcal">';
 foods.appendChild(d);
}

function saveFood(){
 ensure();
 store[currentUser].records[date.value].foods=[...foods.children].map(f=>({
  name:f.children[0].value,
  kcal:Number(f.children[1].value)
 }));
 saveStore();
 drawFood();
}

function saveMember(){
 const n=memberName.value;
 if(!n)return;
 store[n]={profile:{
  start:Number(startWeight.value),
  target:Number(targetWeight.value)
 },records:{}};
 currentUser=n;
 userName.innerText=n;
 saveStore();
 showPage('weight');
}

function drawWeight(){
 const ctx=weightChart.getContext("2d");
 ctx.clearRect(0,0,300,300);
 if(!currentUser)return;
 const rec=Object.entries(store[currentUser].records)
  .slice(-range)
  .map(r=>r[1][timeType].weight)
  .filter(Boolean);
 if(!rec.length)return;
 ctx.beginPath();
 rec.forEach((v,i)=>{
  const x=i*(300/rec.length);
  const y=240-(v/Math.max(...rec))*200;
  i?ctx.lineTo(x,y):ctx.moveTo(x,y);
 });
 ctx.strokeStyle="#ff8fb1";
 ctx.lineWidth=3;
 ctx.stroke();
}

function drawFood(){
 const ctx=foodChart.getContext("2d");
 ctx.clearRect(0,0,300,300);
 if(!currentUser)return;
 const days=Object.values(store[currentUser].records).slice(-30);
 const vals=days.map(d=>d.foods.reduce((s,f)=>s+f.kcal,0));
 if(!vals.length)return;
 ctx.beginPath();
 vals.forEach((v,i)=>{
  const x=i*(300/vals.length);
  const y=240-(v/Math.max(...vals))*200;
  i?ctx.lineTo(x,y):ctx.moveTo(x,y);
 });
 ctx.strokeStyle="#67e8f9";
 ctx.lineWidth=3;
 ctx.stroke();
}
</script>

</body>
</html>
